<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Module : Ombres et Rotation - Version Finale Ombre Marqu√©e</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { 
            --bg: #0b1020; --ink: #eef2ff; --accent: #60a5fa; 
            --success: #4ade80; --error: #f87171; --high-vis: #FFD700; 
        }
        
        body { 
            margin: 0; padding: 10px; font-family: system-ui, sans-serif; 
            background: var(--bg); color: var(--ink); touch-action: pan-y; 
            overflow-y: scroll; -webkit-tap-highlight-color: transparent;
        }

        /* --- NAVIGATION --- */
        .nav-header {
            max-width: 1000px; margin: 0 auto 10px;
            display: flex; gap: 5px; padding: 5px;
            background: rgba(255,255,255,0.05); border-radius: 15px;
            overflow-x: auto; white-space: nowrap; scrollbar-width: none;
        }
        .nav-header::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            flex: 0 0 auto; padding: 10px 16px; border: none; border-radius: 10px;
            background: rgba(255,255,255,0.1); color: white;
            font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 14px;
        }
        .nav-btn.active { background: var(--accent); color: var(--bg); transform: scale(1.05); }

        /* CONTENU */
        .step-content {
            display: none; opacity: 0;
            flex-direction: column; min-height: calc(100vh - 80px);
            max-width: 1000px; margin: auto;
            transition: opacity 0.4s ease;
        }
        .step-content.active { display: flex; opacity: 1; }

        .card { 
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.1); flex-grow: 1; display: flex; flex-direction: column;
            margin-bottom: 20px; overflow-x: hidden;
        }
        .instruction-box { background: rgba(96, 165, 250, 0.1); border-left: 4px solid var(--accent); padding: 12px; border-radius: 12px; margin-bottom: 15px; flex-shrink: 0; }
        
        .anim-wrap { 
            width: 100%; min-height: 300px; background: #000; 
            border-radius: 15px; position: relative; overflow: hidden; 
            border: 1px solid #333; margin-bottom: 15px; 
        }

        .controls { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; flex-wrap: wrap; }
        .btn { 
            background: #333; border: none; color: white; padding: 14px 20px; 
            border-radius: 12px; font-weight: 700; cursor: pointer; flex: 1; 
            min-width: 120px; touch-action: manipulation;
        }
        .btn-val { background: var(--accent); color: var(--bg); }
        .btn.ok { border: 1px solid #4ade80; color: #4ade80; background: rgba(74, 222, 128, 0.1); }
        
        input[type=range] { height: 30px; touch-action: none; }
        .feedback { margin-top: 10px; padding: 10px; border-radius: 12px; font-weight: bold; text-align: center; display: none; }

        .responsive-grid { display: flex; flex-wrap: wrap; gap: 20px; align-items: start; }
        .responsive-grid > * { flex: 1 1 300px; min-width: 280px; max-width: 100%; }

        /* Q2 Specifique */
        .dropzone { 
            position: absolute; width: 22%; height: 12%; 
            border: 2px dashed var(--high-vis); background: rgba(255, 215, 0, 0.1); 
            border-radius: 12px; z-index: 5; display: flex; align-items: center; justify-content: center; 
            font-size: 0.8em; text-align: center; line-height: 1.1;
        }
        #dz_portee { top: 52%; left: 15%; width: 25%; }
        /* D√©calage √† 46% */
        #dz_propre { top: 38%; left: 46%; width: 22%; } 
        #dz_eclairee { top: 38%; left: 73%; width: 22%; }

        .chip { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; border-radius: 999px; background: #1a1f2e; color: var(--ink); font-weight: 700; font-size: 13px; cursor: grab; touch-action: none; border: 1px solid rgba(255,255,255,0.2); margin: 5px; user-select: none; }
        .bank { display: flex; gap: 5px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 15px; margin-top: 10px; min-height: 60px; justify-content: center; flex-wrap: wrap; }
        
        .mcq-section label { display: block; padding: 14px; margin: 8px 0; background: rgba(0,0,0,0.3); border-radius: 10px; cursor: pointer; border: 1px solid transparent; }
        .mcq-section label:hover { border-color: #60a5fa; background: rgba(255,255,255,0.05); }

        /* Q4 Styles */
        .q5rev-space { position: relative; width: 100%; height: 320px; max-width: 520px; margin: 6px auto 0; --r: 100px; }
        .q5rev-orbit-path { position: absolute; left: 50%; top: 50%; width: calc(var(--r) * 2); height: calc(var(--r) * 2); margin-left: calc(var(--r) * -1); margin-top: calc(var(--r) * -1); border-radius: 50%; border: 2px solid rgba(255, 255, 255, .45); }
        .q5rev-sun { position: absolute; left: 50%; top: 50%; width: 60px; height: 60px; margin-left: -30px; margin-top: -30px; border-radius: 50%; background: radial-gradient(circle at 35% 35%, #fff6a0, #ff9a00); box-shadow: 0 0 22px rgba(255, 170, 0, .6); }
        .q5rev-flag { position: absolute; left: 50%; top: 50%; transform: translate(var(--r), -14px); font-size: 20px; user-select: none; }
        .q5rev-orbit { position: absolute; left: 50%; top: 50%; width: 0; height: 0; }
        .q5rev-earth { position: absolute; left: 0; top: 0; width: 36px; height: 36px; border-radius: 50%; transform: translateX(var(--r)); background: radial-gradient(circle at 30% 30%, #bfe7ff, #1e4fd8); box-shadow: 0 0 10px rgba(110, 170, 255, .4); }
        .q5rev-earth::after { content: ""; position: absolute; left: 50%; top: 0; width: 2px; height: 100%; margin-left: -1px; background: rgba(255, 255, 255, .7); }

        /* GLOBE & STAGE */
        .q8wrap{ width:100%; margin:0 auto; }
        .q8card{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:18px; padding:16px; box-shadow:0 18px 50px rgba(0,0,0,.35); }
        .q8grid{ display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; }
        .q8left{ flex: 1 1 300px; min-width: 280px; width: 100%; } 
        .q8right{ flex: 1 1 300px; width: 100%; }
        
        .scene { width: 100%; display: flex; justify-content: center; overflow: hidden; padding: 10px 0; }
        
        .globe { max-width: 300px; width: 80vw; aspect-ratio: 1/1; border-radius: 50%; position:relative; overflow:hidden; background:#2a7be6; border:2px solid rgba(255,255,255,.2); box-shadow:0 20px 60px rgba(0,0,0,.5); }
        .q7earth { position:relative; width:220px; height:220px; border-radius:50%; overflow:hidden; border:2px solid rgba(255,255,255,.2); box-shadow:0 0 50px rgba(0,0,0,.8); background:#2a7be6; z-index:5; }

        .q7stage { position:relative; width:100%; height:320px; display:flex; justify-content:center; align-items:center; overflow:hidden; background: #000; border-radius:12px; border:1px solid #333; }
        .q7sun { position:absolute; left:-40px; top:50%; transform:translateY(-50%); width:120px; height:120px; border-radius:50%; background:radial-gradient(circle,#ffe9a3,#f59e0b 70%); box-shadow:0 0 40px rgba(245,158,11,.6); z-index:2; }
        
        .bg-map { position:absolute; inset:-10%; width:140%; height:120%; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='512' viewBox='0 0 1024 512'><rect width='1024' height='512' fill='%232a7be6'/><path d='M150,260 C220,210 280,210 330,250 C350,275 360,315 330,340 C290,375 235,382 200,350 C175,330 150,310 135,295 Z' fill='%2363c76a' opacity='0.9'/><path d='M610,255 C650,220 720,220 770,255 C800,275 805,315 775,335 C720,368 655,360 628,330 C610,312 595,285 600,272 Z' fill='%2363c76a' opacity='0.9'/></svg>"); background-size: 200% 100%; background-repeat: repeat-x; background-position: var(--bx, 0%) 50%; filter: saturate(1.2) contrast(1.1); }
        .overlay-shine { position:absolute; inset:0; background:radial-gradient(circle at 30% 40%, rgba(255,255,255,.5) 0%, rgba(255,255,255,0) 60%); mix-blend-mode:overlay; pointer-events:none; z-index: 6; }
        
        /* CORRECTION : Ombre plus marqu√©e (0.75) */
        .overlay-night { 
            position:absolute; inset:0; 
            background: linear-gradient(to right, transparent 49.5%, rgba(0,0,0,0.75) 50.5%); 
            pointer-events:none; z-index: 30; mix-blend-mode: multiply; 
        }
        
        .q7track { position:absolute; inset:0; pointer-events:none; z-index: 8; }
        .q7track svg { width:100%; height:100%; display:block; }
        .q7tb { stroke:rgba(255,255,255,0.4); stroke-width:3; stroke-dasharray:5 5; fill:none; }
        .q7tf { stroke:#ff4d8d; stroke-width:4; fill:none; }
        
        .q7marker { position:absolute; width:14px; height:14px; border-radius:50%; background:#ff4d8d; box-shadow:0 0 0 3px #fff; transform:translate(-50%,-50%); z-index:10; }

        .city, .q10-point { position:absolute; width:12px; height:12px; border-radius:50%; border:2px solid #fff; box-shadow:0 0 0 3px rgba(0,0,0,.35); transform: translate(-50%,-50%); z-index:15; }
        .city { background: #ef4444; }
        .city::after, .q10-point::after { content: attr(data-label); position:absolute; left: 14px; top: -6px; font-weight:950; font-size:12px; color:#fff; white-space:nowrap; text-shadow: 0 2px 8px rgba(0,0,0,.85); }
        
        /* ===== CSS IMPORT√â DE INDEX.HTML POUR Q9 ===== */
        #step9 .q10-grid{ display:grid; grid-template-columns: 1.05fr 1fr; gap:14px; align-items:start; }
        #step9 .q10-toprow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:10px; }
        #step9 .q10-pill{ padding:7px 10px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14); font-weight:900; font-size:13px; }
        #step9 .q10-scene{ display:flex; align-items:center; justify-content:center; gap:22px; padding:10px 0 6px; }
        #step9 .q10-sun{ width:150px; height:150px; border-radius:50%; background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.95) 0%, rgba(255,232,168,.92) 18%, rgba(255,193,7,.85) 45%, rgba(255,152,0,.70) 70%, rgba(255,152,0,.35) 100%); filter: drop-shadow(0 16px 40px rgba(255,193,7,.25)); }
        #step9 .q10-earth{ width:240px; height:240px; border-radius:50%; position:relative; overflow:hidden; background:#071027; border:1px solid rgba(255,255,255,.14); box-shadow:0 20px 60px rgba(0,0,0,.35); }
        #step9 .q10-tex{ position:absolute; inset:0; border-radius:50%; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='512' viewBox='0 0 1024 512'><defs><linearGradient id='sea' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='%232a7be6'/><stop offset='1' stop-color='%230a3b7a'/></linearGradient></defs><rect width='1024' height='512' fill='url(%23sea)'/><g opacity='0.22' fill='white'><ellipse cx='140' cy='90' rx='100' ry='40'/><ellipse cx='250' cy='140' rx='140' ry='52'/><ellipse cx='740' cy='110' rx='150' ry='52'/><ellipse cx='890' cy='170' rx='130' ry='48'/></g><g fill='%233bbf6a'><path d='M160,265 C230,210 300,210 350,255 C372,280 380,325 350,352 C305,390 245,395 208,358 C180,335 155,312 142,298 Z'/><path d='M430,195 C495,160 575,170 620,208 C652,235 660,272 625,295 C570,333 498,326 465,292 C445,270 420,238 415,223 Z'/><path d='M635,255 C680,218 755,220 810,258 C840,278 848,320 815,340 C755,376 685,368 655,336 C635,315 620,285 625,270 Z'/></g></svg>"); background-size:200% 100%; background-repeat:repeat-x; background-position: var(--bx, 0%) 50%; transform: translateZ(0); }
        #step9 .q10-sphere{ position:absolute; inset:0; border-radius:50%; pointer-events:none; background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.28) 0%, rgba(255,255,255,.10) 35%, rgba(255,255,255,0) 62%), radial-gradient(circle at 70% 75%, rgba(0,0,0,.10) 0%, rgba(0,0,0,.25) 55%, rgba(0,0,0,.40) 78%, rgba(0,0,0,.50) 100%); mix-blend-mode:multiply; }
        #step9 .q10-daynight{ position:absolute; inset:0; border-radius:50%; pointer-events:none; background: linear-gradient(to right, rgba(255,255,255,0.30) 0%, rgba(255,255,255,0.05) 35%, rgba(0,0,0,0.70) 52%, rgba(0,0,0,0.92) 68%, rgba(0,0,0,0.98) 100%); mix-blend-mode:multiply; }
        #step9 .q10-point{ position:absolute; width:12px; height:12px; border-radius:50%; background:#111827; border:2px solid #fff; box-shadow:0 0 0 3px rgba(0,0,0,.35); transform: translate(-50%,-50%); z-index:6; }
        #step9 .q10-point::after{ content: attr(data-label); position:absolute; left: 14px; top: -6px; font-weight:950; font-size:12px; color:#fff; white-space:nowrap; text-shadow: 0 2px 8px rgba(0,0,0,.85); }
        #step9 .q10-controls{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-start; margin-top:10px; }
        #step9 .q10-q{ margin:10px 0; padding:10px; border-radius:14px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); }
        #step9 .q10-qtitle{ font-weight:950; margin-bottom:4px; }
        #step9 .q10-mini{ opacity:.9; font-size:14px; margin-bottom:8px; }
        #step9 .q10-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin:6px 0; }
        #step9 .q10-lbl{ width:70px; font-weight:900; }
        #step9 .q10-choice{ display:block; margin:6px 0; font-weight:800; }
        #step9 .q10-res{ margin-top:10px; font-weight:950; }
        #step9 .q10-terminator{ position:absolute; top:0; bottom:0; left:50%; width:0; border-left:2px dashed rgba(255,255,255,0.7); pointer-events:none; z-index:5; }
        
        .q10-grid { display: grid; gap: 20px; }
        svg { width: 100%; height: auto; display: block; }
        table { width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:18px; border:1px solid rgba(255,255,255,0.12); margin-top: 15px; }
        th,td { padding:12px 5px; border-bottom:1px solid rgba(255,255,255,0.12); text-align: center; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="nav-header">
    <button class="nav-btn active" onclick="showStep(1)">Q1</button>
    <button class="nav-btn" onclick="showStep(2)">Q2</button>
    <button class="nav-btn" onclick="showStep(3)">Q3</button>
    <button class="nav-btn" onclick="showStep(4)">Q4</button>
    <button class="nav-btn" onclick="showStep(5)">Q5</button>
    <button class="nav-btn" onclick="showStep(6)">Q6</button>
    <button class="nav-btn" onclick="showStep(7)">Q7</button>
    <button class="nav-btn" onclick="showStep(8)">Q8</button>
    <button class="nav-btn" onclick="showStep(9)">Q9</button>
    <button class="nav-btn" onclick="showStep(10)">Bilan</button>
</div>

<div id="step1" class="step-content active">
    <div class="card">
        <div class="instruction-box"><p><strong>1. Ombres :</strong> Allume le projecteur. L'objet est-il enti√®rement √©clair√© ?</p></div>
        <div class="controls">
            <button class="btn btn-val" id="btn-dancer" onclick="setObj1('dancer')">üíÉ Danseuse</button>
            <button class="btn" id="btn-sphere" onclick="setObj1('sphere')">‚ö™ Boule</button>
        </div>
        <div class="controls" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;">
            <span style="font-weight:bold; color:var(--accent)">Intensit√© :</span>
            <input type="range" min="0" max="6" step="0.1" value="4" oninput="updateLight1(this.value)" style="flex:2">
            <span id="valTxt1" style="min-width: 40px; text-align: right;">65%</span>
        </div>
        <div id="q1AnimWrap" class="anim-wrap"></div>
        <div class="controls"><button class="btn" onclick="check1(false)">NON</button><button class="btn" onclick="check1(true)">OUI</button></div>
        <div id="fb1" class="feedback"></div>
    </div>
</div>

<div id="step2" class="step-content">
    <div class="card">
        <div class="instruction-box"><p><strong>2. Identification :</strong> Glisse les √©tiquettes dans les zones correspondantes.</p></div>
        <div class="controls"><button class="btn btn-val" onclick="validate2()">V√âRIFIER</button><button class="btn" onclick="reset2()">RECOMMENCER</button></div>
        <div id="q2AnimWrap" class="anim-wrap" style="height: 400px;">
            <div id="dz_portee" class="dropzone"></div>
            <div id="dz_propre" class="dropzone"></div> 
            <div id="dz_eclairee" class="dropzone"></div>
        </div>
        <div class="bank" id="bank2"><div id="chip_portee" class="chip" data-target="dz_portee">Ombre port√©e</div><div id="chip_propre" class="chip" data-target="dz_propre">Ombre propre</div><div id="chip_eclairee" class="chip" data-target="dz_eclairee">Zone √©clair√©e</div></div>
        <div id="fb2" class="feedback"></div>
    </div>
</div>

<div id="step3" class="step-content">
    <div class="card">
        <div class="instruction-box"><p><strong>3. Rotation :</strong> Quelle est la dur√©e d'un tour complet de la Terre ?</p></div>
        <div class="responsive-grid">
            <div style="background:#000; border-radius:15px; padding:10px; border:1px solid #333; position: relative;">
                <svg viewBox="0 0 520 280"><circle cx="60" cy="140" fill="#f59e0b" r="40"></circle><g id="rotTopG" transform="translate(340 140)"><circle fill="#2dd4bf" r="85" opacity=".9"></circle><path d="M0,-85 A85,85 0 0,1 0,85 A85,85 0 0,1 0,-85 Z" fill="rgba(0,0,0,.5)"></path><circle cx="0" cy="-70" fill="#ff4d8d" r="8" stroke="white" stroke-width="2"></circle><line x1="0" y1="0" x2="0" y2="-70" stroke="white" stroke-width="1" stroke-dasharray="3"/></g><text id="q3TimeText" x="480" y="40" fill="var(--accent)" font-size="28" font-weight="900" text-anchor="end">0h</text><text x="340" y="260" fill="white" text-anchor="middle" font-size="18" opacity="0.8">Vue du P√¥le Nord</text></svg>
            </div>
            <div style="background:#000; border-radius:15px; padding:10px; border:1px solid #333;">
                <svg viewBox="0 0 520 280"><circle cx="60" cy="140" fill="#f59e0b" r="40"></circle><g transform="translate(340 140)"><path d="M -85 0 A 85 20 0 0 1 85 0" fill="none" stroke="white" stroke-dasharray="6,4" stroke-width="3" opacity="1" /><circle fill="#0ea5e9" r="85" opacity="0.6"></circle><path d="M 0 -85 A 85 85 0 0 1 0 85 L 0 0 Z" fill="rgba(0,0,0,.5)"></path><path d="M -85 0 A 85 20 0 0 0 85 0" fill="none" stroke="white" stroke-width="3" /><circle id="rotCityProf" cx="-85" cy="0" fill="#ff4d8d" r="8" stroke="white" stroke-width="2"></circle></g><text x="340" y="260" fill="white" text-anchor="middle" font-size="18" opacity="0.8">Vue de l'√âquateur</text></svg>
            </div>
        </div>
        <div class="controls" style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-top:20px;">
            <input id="rotAns" type="number" style="width:80px; padding:10px; border-radius:8px; font-size:16px;">
            <select id="rotUnit" style="padding:10px; border-radius:8px; font-size:16px;"><option value="h">heures</option><option value="jour">jour</option></select>
            <button class="btn btn-val" onclick="check3()">Valider</button>
            <div style="flex-basis:100%; display:flex; align-items:center; gap:10px; margin-top:10px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                <span>Faire tourner :</span>
                <input type="range" min="0" max="24" step="0.5" value="0" oninput="setRot3(this.value)" style="flex:1;">
            </div>
        </div>
        <div id="st3" class="feedback"></div>
    </div>
</div>

<div id="step4" class="step-content">
    <div class="card">
        <h2>Question 4 ‚Äî La r√©volution de la Terre</h2>
        <div class="instruction-box"><p><strong>Consigne :</strong> Appuie sur <strong>Play</strong> pour faire tourner la Terre.</p></div>
        
        <div class="responsive-grid">
            <div class="anim-wrap" style="height:auto; min-height:340px; padding:10px; background:#000; overflow:hidden;">
                <div class="row" style="justify-content:space-between; color:white; margin-bottom:10px;">
                    <strong>Mod√®le</strong>
                    <span class="pill" id="revDayLbl" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:15px;">Jour : 0</span>
                </div>
                <div class="q5rev-space">
                    <div aria-hidden="true" class="q5rev-orbit-path"></div>
                    <div aria-hidden="true" class="q5rev-sun"></div>
                    <div aria-hidden="true" class="q5rev-flag">üö©</div>
                    <div class="q5rev-orbit" id="q5Orbit">
                        <div aria-hidden="true" class="q5rev-earth" id="q5Earth"></div>
                    </div>
                </div>
                <div class="controls" style="justify-content:center; margin-top:10px; flex-wrap:wrap;">
                    <button class="btn" id="revPlayBtn" onclick="toggleRevPlay()">‚ñ∂Ô∏é Play</button>
                    <button class="btn" id="revAccelBtn" onclick="toggleRevAccel()">üöÄ Acc√©l√©rer</button>
                    <button class="btn" onclick="addRevDay(30)">+30 j</button>
                    <button class="btn" onclick="addRevDay(90)">+90 j</button>
                </div>
            </div>

            <div class="animWrap" style="height:auto; background:rgba(255,255,255,0.05); border:none; padding: 20px;">
                <p>Combien de temps met la Terre pour faire un tour complet autour du Soleil ?</p>
                <div class="row" style="margin-bottom:10px;">
                    <input class="inputNum" id="revAns" type="number" placeholder="nombre" style="padding:10px; border-radius:8px; border:1px solid #555; background:#222; color:white; width: 100px;">
                    <select id="revUnit" style="padding:10px; border-radius:8px;">
                        <option value="">unit√©</option>
                        <option value="s">s</option>
                        <option value="h">h</option>
                        <option value="jour">jour</option>
                        <option value="annees">ann√©es</option>
                    </select>
                </div>
                <button class="btn primary" onclick="checkRev()">Valider</button>
                <div class="status" id="st4"></div>
            </div>
        </div>
    </div>
</div>

<div id="step5" class="step-content">
    <div class="card">
        <h2>Question 5 ‚Äî Mouvement autour du Soleil</h2>
        <div class="instruction-box" style="margin-bottom:15px;">
            <strong>Rappel :</strong><br>
            ‚Ä¢ <strong>Rotation</strong> : mouvement sur elle‚Äëm√™me.<br>
            ‚Ä¢ <strong>R√©volution</strong> : mouvement autour du Soleil.
        </div>

        <div class="responsive-grid">
            <div class="anim-wrap" style="height:auto; min-height:auto; padding:15px; background:#000;">
                <svg aria-label="R√©volution simple" role="img" viewBox="0 0 520 260" style="width:100%;">
                    <circle cx="260" cy="130" fill="rgba(255,211,77,.85)" r="40"></circle>
                    <ellipse cx="260" cy="130" fill="none" rx="170" ry="90" stroke="rgba(255,255,255,.25)" stroke-width="3"></ellipse>
                    <g id="revMiniG" transform="translate(430 130)"><circle fill="#2dd4bf" opacity=".95" r="18"></circle></g>
                </svg>
                <div class="controls" style="justify-content:center; margin-top:10px;">
                    <span style="font-size:12px; color:#b8c1ff;">Position</span>
                    <input id="revMini" max="360" min="0" oninput="setRevMini(this.value)" step="5" type="range" value="0" style="flex:1"/>
                </div>
            </div>
            <div class="mcq-section">
                <p>Comment s‚Äôappelle ce mouvement ?</p>
                <label><input name="q5" type="radio" value="rotation"/> Rotation</label>
                <label><input name="q5" type="radio" value="revolution"/> R√©volution</label>
                <label><input name="q5" type="radio" value="zigzag"/> Zigzag</label>
                <button class="btn btn-val" onclick="checkQ5()" style="margin-top:15px;">Valider</button>
                <div class="feedback" id="statusQ5"></div>
            </div>
        </div>
    </div>
</div>

<div id="step6" class="step-content">
    <div class="card">
        <h2>Question 6 ‚Äî Mod√©liser l‚Äôalternance jour / nuit</h2>
        <div class="instruction-box"><p><strong>Consigne :</strong> Fais tourner la Terre et observe le mouvement de la ville localis√©e par un point rouge. Quand est-elle dans le jour ? Quand entre-t-elle dans la nuit ?</p></div>
        
        <div id="q6AnimWrap" class="anim-wrap" style="height:auto; padding:20px; display:flex; flex-direction:column; gap:15px; background:#0b1020;">
            <div class="row" style="justify-content:space-between; color:white;">
                <strong>Boule √©clair√©e</strong>
                <span class="pill" id="modLbl" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:15px;">Heure : 0</span>
            </div>
            <div class="q7stage">
                <div class="q7sun"></div>
                <div class="q7earth" id="q7Earth">
                    <div class="bg-map"></div>
                    <div class="overlay-shine"></div>
                    <div class="overlay-night"></div>
                    <div class="q7track" style="z-index: 25;">
                        <svg viewBox="0 0 220 220">
                            <path class="q7tb" d="M 22 66 A 88 22 0 0 1 198 66" style="stroke:rgba(255,255,255,0.4); stroke-width:3; stroke-dasharray:6 4; fill:none;"></path>
                            <path class="q7tf" d="M 198 66 A 88 22 0 0 1 22 66" style="stroke:#ff4d8d; stroke-width:4; fill:none;"></path>
                        </svg>
                    </div>
                    <div class="q7marker" id="q7Marker" style="z-index: 26;"></div>
                </div>
            </div>
            <div class="controls" style="justify-content: center;">
                <input id="modHour" max="24" min="0" oninput="setModHour(this.value)" step="1" type="range" value="0" style="flex:1;">
                <button class="btn" onclick="addMod(12)">+12 h</button>
            </div>
        </div>
        <div class="mcq-section">
            <p>Quand la ville passe de la partie √©clair√©e √† la partie sombre, que se passe-t-il pour un observateur sur Terre ?</p>
            <label><input type="radio" name="q6" value="jour_nuit"> Il passe du jour √† la nuit.</label>
            <label><input type="radio" name="q6" value="ete_hiver"> Il passe de l‚Äô√©t√© √† l‚Äôhiver.</label>
            <label><input type="radio" name="q6" value="distance"> La Terre s'√©loigne du Soleil.</label>
            <button class="btn btn-val" onclick="checkQ6()">V√âRIFIER</button>
            <div id="fb6" class="feedback"></div>
            <button class="btn ok" style="margin-top:20px; width:100%;" onclick="showStep(7)">Question 7 ‚Üí</button>
        </div>
    </div>
</div>

<div id="step7" class="step-content">
    <div class="card">
        <div class="q8title">Question 7 ‚Äî Jour et nuit</div>
        <div class="instruction-box"><p><strong>Consigne :</strong> Observe la position des villes. Si une ville est dans l'ombre (partie sombre), il fait nuit. Si elle est au soleil, il fait jour.</p></div>
        <div class="q8grid responsive-grid">
            <div class="q8left">
                <div class="scene">
                    <div class="globe" id="globeQ7">
                        <div class="bg-map" id="q8tex"></div>
                        <div class="overlay-night"></div>
                    </div>
                </div>
                <div class="row" style="margin-top:10px; display:flex; gap:10px;">
                    <button class="btn primary" id="q8startBtn">D√©marrer</button>
                    <button class="btn" id="q8speed2Btn">Vitesse √ó2</button>
                </div>
            </div>
            <div class="q8right">
                <div class="qcm">
                    <div class="q">1. Si Madrid est √©clair√©, il fait jour √† Madrid ?<br/><label><input name="q8q1" type="radio" value="v"/> Vrai</label> <label><input name="q8q1" type="radio" value="f"/> Faux</label></div>
                    <div class="q">2. Si Sydney est dans l'ombre, il fait jour √† Sydney ?<br/><label><input name="q8q2" type="radio" value="v"/> Vrai</label> <label><input name="q8q2" type="radio" value="f"/> Faux</label></div>
                    <div class="q">3. L'alternance jour/nuit est due √† la rotation de la Terre ?<br/><label><input name="q8q3" type="radio" value="v"/> Vrai</label> <label><input name="q8q3" type="radio" value="f"/> Faux</label></div>
                    <button class="btn primary" onclick="corrigerQ8()" style="width:100%; margin-top:10px;">Corriger</button>
                    <div id="resQ8" style="margin-top:8px; font-weight:900"></div>
                    <button class="btn ok" style="margin-top:20px; width:100%;" onclick="showStep(8)">Question 8 ‚Üí</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="step8" class="step-content">
    <div class="card">
        <h2>Question 8 ‚Äî +12h / +24h</h2>
        <div class="anim-wrap" style="background:#000; border:1px solid #333; padding:15px; display:flex; flex-direction:column; gap:10px; height:auto;">
            <div class="row" style="justify-content:space-between"><strong>Instant</strong><span class="pill" id="tSel" style="background:#333; padding:5px 10px; border-radius:10px;">0 h</span></div>
            <svg viewBox="0 0 560 260" style="width:100%; height:auto;"><circle cx="110" cy="130" fill="rgba(255,211,77,.85)" r="45"></circle><g id="tG" transform="translate(380 130)"><circle fill="#2dd4bf" opacity=".9" r="95"></circle><path d="M0,-95 A95,95 0 0,1 0,95 A95,95 0 0,1 0,-95 Z" fill="rgba(0,0,0,.48)"></path><circle cx="60" cy="-25" fill="#ff4d8d" r="7" stroke="white" stroke-width="3"></circle><text fill="white" font-size="13" x="78" y="-28">Madrid</text><circle cx="-60" cy="30" fill="#60a5fa" r="7" stroke="white" stroke-width="3"></circle><text fill="white" font-size="13" x="-150" y="34">Sydney</text></g></svg>
            <div class="row" style="gap:14px; margin-top:6px; justify-content:center;"><button class="btn" onclick="setT(0)">0 h</button><button class="btn" onclick="setT(12)">+12 h</button><button class="btn" onclick="setT(24)">+24 h</button></div>
        </div>
        <table><thead><tr><th>Ville</th><th>Jour</th><th>Nuit</th></tr></thead><tbody><tr><td>Madrid</td><td><input name="m_t" type="radio" value="jour"/></td><td><input name="m_t" type="radio" value="nuit"/></td></tr><tr><td>Sydney</td><td><input name="s_t" type="radio" value="jour"/></td><td><input name="s_t" type="radio" value="nuit"/></td></tr></tbody></table>
        <div class="status" id="st8"></div>
        <div class="row" style="margin-top:20px"><button class="btn primary" onclick="checkT()">Valider</button><button class="btn ok" onclick="showStep(9)">Question 9 ‚Üí</button></div>
    </div>
</div>

<div id="step9" class="step-content">
    <div id="s9" class="card">
      <div class="q10-consigne">
        <strong>Consigne :</strong> Observe la <strong>situation 1</strong>. Clique ensuite sur <strong>+6 h</strong> pour passer √† la <strong>situation 2</strong>.
        D√©termine si les points <strong>A</strong>, <strong>B</strong> et <strong>C</strong> sont le <strong>jour</strong> (c√¥t√© √©clair√©) ou la <strong>nuit</strong> (c√¥t√© sombre).
      </div>
      <div class="q10-grid">
        <div class="q10-anim card">
          <div class="q10-toprow">
            <div class="q10-pill" id="q10State">Situation 1</div>
            <div class="q10-pill" id="q10Time">t = 0 h</div>
          </div>
          <div class="q10-scene">
            <div class="q10-sun"></div>
            <div class="q10-earthWrap">
              <div class="q10-earth" id="q10Earth">
                <div class="q10-tex" id="q10Tex"></div>
                <div class="q10-sphere"></div>
                <div class="q10-daynight"></div>
                <div class="q10-point" id="q10A" data-label="A"></div>
                <div class="q10-point" id="q10B" data-label="B"></div>
                <div class="q10-point" id="q10C" data-label="C"></div>
              </div>
              <div class="q10-earthLabel">Terre</div>
            </div>
          </div>
          <div class="q10-controls">
            <button class="btn" id="q10Plus6">+6 h</button>
            <button class="btn" id="q10Reset">Retour Situation 1</button>
          </div>
        </div>
        <div class="q10-qcm card">
          <div style="font-weight:900; margin-bottom:6px">Questions</div>
          <div class="q10-q">
            <div class="q10-qtitle">10.1 ‚Äì Situation 1 (t = 0 h)</div>
            <div class="q10-mini">Indique si chaque point est <strong>Jour</strong> ou <strong>Nuit</strong>.</div>
            <div class="q10-row"><div class="q10-lbl">Point A</div><label><input type="radio" name="q10_s1_a" value="jour"> Jour</label><label><input type="radio" name="q10_s1_a" value="nuit"> Nuit</label></div>
            <div class="q10-row"><div class="q10-lbl">Point B</div><label><input type="radio" name="q10_s1_b" value="jour"> Jour</label><label><input type="radio" name="q10_s1_b" value="nuit"> Nuit</label></div>
            <div class="q10-row"><div class="q10-lbl">Point C</div><label><input type="radio" name="q10_s1_c" value="jour"> Jour</label><label><input type="radio" name="q10_s1_c" value="nuit"> Nuit</label></div>
          </div>
          <div class="q10-q">
            <div class="q10-qtitle">10.2 ‚Äì Situation 2 (6 h plus tard)</div>
            <div class="q10-mini">Apr√®s <strong>+6 h</strong>, indique √† nouveau <strong>Jour</strong> ou <strong>Nuit</strong>.</div>
            <div class="q10-row"><div class="q10-lbl">Point A</div><label><input type="radio" name="q10_s2_a" value="jour"> Jour</label><label><input type="radio" name="q10_s2_a" value="nuit"> Nuit</label></div>
            <div class="q10-row"><div class="q10-lbl">Point B</div><label><input type="radio" name="q10_s2_b" value="jour"> Jour</label><label><input type="radio" name="q10_s2_b" value="nuit"> Nuit</label></div>
            <div class="q10-row"><div class="q10-lbl">Point C</div><label><input type="radio" name="q10_s2_c" value="jour"> Jour</label><label><input type="radio" name="q10_s2_c" value="nuit"> Nuit</label></div>
          </div>
          <div class="q10-q">
            <div class="q10-qtitle">10.3 ‚Äì Retour √† la position initiale</div>
            <div class="q10-mini">Au bout de combien de temps les points retrouveront-ils la position de la Situation 1 ?</div>
            <label class="q10-choice"><input type="radio" name="q10_tour" value="24"> 24 h</label>
            <label class="q10-choice"><input type="radio" name="q10_tour" value="12"> 12 h</label>
          </div>
          <button class="btn primary" id="q10Check">Corriger</button>
          <div id="q10Res" class="q10-res"></div>
          <button class="btn ok" style="margin-top:20px; width:100%;" onclick="showStep(10)">Vers la synth√®se ‚Üí</button>
        </div>
      </div>
    </div>
</div>

<div id="step10" class="step-content">
    <div class="card" style="border-color: #4ade80; background: rgba(74, 222, 128, 0.05);">
        <h2 style="color:#4ade80; text-align:center; font-size:1.8rem; margin-bottom:20px;">Synth√®se du module</h2>
        <div style="font-size:1.1rem; line-height:1.6; padding: 20px; text-align:center;">
            <p>La Terre tourne sur elle-m√™me en environ <strong>24 heures</strong>.</p>
            <p>Lorsqu‚Äôun point de la surface terrestre se trouve du c√¥t√© <strong>√©clair√©</strong> par le Soleil, il fait <strong>jour</strong>.</p>
            <p>Lorsqu‚Äôil se trouve du c√¥t√© <strong>sombre</strong>, il fait <strong>nuit</strong>.</p>
            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:25px 50px;">
            <p style="font-weight:900; color: #60a5fa; font-size:1.3rem;">La rotation de la Terre explique donc l‚Äôalternance du jour et de la nuit.</p>
        </div>
        <div style="margin-top:30px; text-align:center;">
            <button class="btn" onclick="showStep(1)">‚Ü∫ Recommencer</button>
        </div>
    </div>
</div>

<script>
    // --- NAVIGATION ---
    function showStep(n) {
        document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('step' + n).classList.add('active');
        
        var btns = document.querySelectorAll('.nav-btn');
        if(n <= 9) btns[n-1].classList.add('active');
        else if(n === 10) btns[9].classList.add('active'); 

        // Initialisation √† la demande
        if(n===1 && !scene1) initQ1();
        if(n===2 && !scene2) initQ2();
        if(n===4) initQ4();
        if(n===6) initQ6(); 
        if(n===7) initQ7();
        if(n===8) initQ8();
        if(n===9) initQ9();
        
        window.scrollTo(0, 0);
        setTimeout(() => { 
            if(n===1) onResize1(); 
            if(n===2) onResize2(); 
        }, 100);
    }

    // --- Q1 ---
    var scene1,camera1,renderer1,light1,meshes1={}, bulbMesh;
    function initQ1(){
        var c=document.getElementById("q1AnimWrap"); if(!c) return;
        scene1=new THREE.Scene(); 
        camera1=new THREE.PerspectiveCamera(45,c.clientWidth/c.clientHeight,0.1,1000); 
        camera1.position.set(-25, 10, 50); camera1.lookAt(5, 0, 0);
        renderer1=new THREE.WebGLRenderer({antialias:true}); renderer1.setSize(c.clientWidth,c.clientHeight); renderer1.shadowMap.enabled=true; c.appendChild(renderer1.domElement);
        var screen = new THREE.Mesh(new THREE.PlaneGeometry(130, 70), new THREE.MeshPhongMaterial({color:0xffffff}));
        screen.position.set(0, 5, -20); screen.receiveShadow = true; scene1.add(screen);
        light1 = new THREE.SpotLight(0xffffff, 1.5); light1.position.set(25, 10, 35); light1.castShadow = true;
        light1.angle = Math.PI/6; light1.penumbra = 0.2; scene1.add(light1); scene1.add(light1.target); light1.target.position.set(5, 0, -20);
        var projGroup = new THREE.Group(); projGroup.position.copy(light1.position); projGroup.lookAt(5, 0, -20);
        var body = new THREE.Mesh(new THREE.CylinderGeometry(2, 4, 6, 32), new THREE.MeshPhongMaterial({color:0x444444})); body.rotation.x = -Math.PI/2; projGroup.add(body);
        bulbMesh = new THREE.Mesh(new THREE.SphereGeometry(1.8,16,16), new THREE.MeshBasicMaterial({color:0xffff00})); bulbMesh.position.set(0, 0, 3.5); projGroup.add(bulbMesh);
        scene1.add(projGroup); scene1.add(new THREE.AmbientLight(0xffffff, 0.1));
        var d=new THREE.Group(); var sk=new THREE.MeshPhongMaterial({color:0xffdbac}), dr=new THREE.MeshPhongMaterial({color:0xff0088});
        var t=new THREE.Mesh(new THREE.CylinderGeometry(0.6,0.8,4), dr); t.position.y=0; d.add(t);
        var h=new THREE.Mesh(new THREE.SphereGeometry(1), sk); h.position.y=3; d.add(h);
        var k=new THREE.Mesh(new THREE.CylinderGeometry(0.8,3.8,1.8,32), dr); k.position.y=-1.5; d.add(k);
        var aL=new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,3.5), sk); aL.position.set(1.2,2.5,0); aL.rotation.z=-0.6; d.add(aL);
        var aR=new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,3.5), sk); aR.position.set(-1.2,2.5,0); aR.rotation.z=0.6; d.add(aR);
        d.traverse(n=>{if(n.isMesh)n.castShadow=true;}); d.scale.set(1.6, 1.6, 1.6); d.position.set(5, -3, 5); 
        meshes1.dancer=d; meshes1.sphere=new THREE.Mesh(new THREE.SphereGeometry(5,32,32),new THREE.MeshPhongMaterial({color:0xcccccc})); 
        meshes1.sphere.position.set(5, -3, 5); meshes1.sphere.castShadow=true; meshes1.sphere.visible=false;
        scene1.add(meshes1.dancer, meshes1.sphere); animate1();
    }
    function updateLight1(v){ light1.intensity=parseFloat(v); var r=Math.min(v/5,1); bulbMesh.material.color.copy(new THREE.Color(0x111111)).lerp(new THREE.Color(0xffff00),r); document.getElementById('valTxt1').textContent=Math.round(v*16)+"%"; }
    function setObj1(t){ meshes1.dancer.visible=(t==='dancer'); meshes1.sphere.visible=(t==='sphere'); }
    function check1(o){ var f=document.getElementById('fb1'); f.style.display="block"; f.innerHTML=o?"‚ùå NON.":"‚úÖ CORRECT !"; f.style.color=o?"var(--error)":"var(--success)"; }
    function animate1(){ requestAnimationFrame(animate1); if(meshes1.dancer.visible) meshes1.dancer.rotation.y+=0.01; renderer1.render(scene1,camera1); }
    function onResize1(){ var c=document.getElementById("q1AnimWrap"); if(renderer1 && c){ renderer1.setSize(c.clientWidth,c.clientHeight); camera1.aspect=c.clientWidth/c.clientHeight; camera1.updateProjectionMatrix();} }

    // --- Q2 ---
    var scene2,camera2,renderer2,earth2;
    function initQ2(){
        var c=document.getElementById("q2AnimWrap"); if(!c) return;
        scene2=new THREE.Scene(); camera2=new THREE.PerspectiveCamera(35,c.clientWidth/c.clientHeight,0.1,1000); camera2.position.set(30,25,80); camera2.lookAt(-15,5,0);
        renderer2=new THREE.WebGLRenderer({antialias:true}); renderer2.setSize(c.clientWidth,c.clientHeight); renderer2.shadowMap.enabled=true; c.appendChild(renderer2.domElement);
        var s=new THREE.Mesh(new THREE.PlaneGeometry(60,40),new THREE.MeshPhongMaterial({color:0xffffff})); s.position.set(-60,10,0); s.rotation.y=Math.PI/2; s.receiveShadow=true; scene2.add(s);
        earth2=new THREE.Mesh(new THREE.SphereGeometry(7,32,32),new THREE.MeshPhongMaterial({color:0x2266ff})); earth2.position.set(10,10,0); earth2.castShadow=true; scene2.add(earth2);
        var l=new THREE.PointLight(0xffffff,1.5,300); l.position.set(50,10,0); l.castShadow=true; l.shadow.mapSize.width=2048; l.shadow.mapSize.height=2048; l.shadow.radius=0; scene2.add(l); scene2.add(new THREE.AmbientLight(0xffffff,0.1));
        var bGeo=new THREE.SphereGeometry(2,16,16); var bMat=new THREE.MeshBasicMaterial({color:0xffff00}); var bulb=new THREE.Mesh(bGeo,bMat); bulb.position.copy(l.position); scene2.add(bulb);
        animate2(); setupDrag2();
    }
    function setupDrag2(){ 
        var dItem=null, off={x:0,y:0}; const chips = document.querySelectorAll('.chip');
        chips.forEach(el=>{
            const start = (e) => {
                dItem=el; var r=el.getBoundingClientRect(); 
                var clientX = e.touches ? e.touches[0].clientX : e.clientX; var clientY = e.touches ? e.touches[0].clientY : e.clientY;
                off.x=clientX-r.left; off.y=clientY-r.top; el.style.position='fixed'; el.style.zIndex="1000"; el.style.width = r.width + 'px';
            };
            el.addEventListener('mousedown', start); el.addEventListener('touchstart', start, {passive: false});
        });
        const move = (e) => { if(!dItem) return; e.preventDefault(); 
            var clientX = e.touches ? e.touches[0].clientX : e.clientX; var clientY = e.touches ? e.touches[0].clientY : e.clientY;
            dItem.style.left=(clientX-off.x)+'px'; dItem.style.top=(clientY-off.y)+'px';
        };
        document.addEventListener('mousemove', move); document.addEventListener('touchmove', move, {passive: false});
        const end = (e) => { if(!dItem) return; checkDrop2(dItem, e); dItem=null; };
        document.addEventListener('mouseup', end); document.addEventListener('touchend', (e)=>{ if(dItem) { checkDrop2(dItem, e.changedTouches[0]); dItem=null; } });
    }
    function checkDrop2(item, e){ 
        var clientX = e.clientX || e.pageX; var clientY = e.clientY || e.pageY;
        var dzs=document.querySelectorAll('.dropzone'); var drop=false; 
        dzs.forEach(dz=>{
            var r=dz.getBoundingClientRect(); 
            if(clientX>r.left && clientX<r.right && clientY>r.top && clientY<r.bottom){
                dz.appendChild(item); item.style.position="absolute"; item.style.left="0"; item.style.top="0"; item.style.width="100%"; item.style.height="100%"; item.style.margin="0"; drop=true;
            }
        }); 
        if(!drop){ document.getElementById('bank2').appendChild(item); item.style.position="static"; item.style.width="auto"; item.style.margin="5px"; }
    }
    function validate2(){ var f=document.getElementById('fb2'), ok=true, count=0; document.querySelectorAll('.dropzone').forEach(dz=>{var c=dz.querySelector('.chip'); if(c)count++; if(!c||c.dataset.target!==dz.id)ok=false}); f.innerHTML=(ok&&count===3)?"‚úÖ BRAVO !":"‚ùå ERREUR."; f.style.display="block"; f.style.color=(ok&&count===3)?"var(--success)":"var(--error)"}
    function reset2(){ document.querySelectorAll('.chip').forEach(c=>{document.getElementById('bank2').appendChild(c); c.style.position="static"; c.style.margin="5px";}); }
    function animate2(){ requestAnimationFrame(animate2); if(earth2) earth2.rotation.y+=0.003; renderer2.render(scene2,camera2); }
    function onResize2(){ var c=document.getElementById("q2AnimWrap"); if(renderer2 && c){ renderer2.setSize(c.clientWidth,c.clientHeight); camera2.aspect=c.clientWidth/c.clientHeight; camera2.updateProjectionMatrix();} }

    // --- Q3/Q4 ---
    function setRot3(h){ document.getElementById('q3TimeText').textContent = Math.floor(h) + 'h'; document.getElementById('rotTopG').setAttribute('transform','translate(340 140) rotate('+(h/24*360)+')'); const rad = (h/24)*Math.PI*2 + Math.PI; const rx = 85, ry = 20; const cx = rx * Math.cos(rad); const cy = ry * Math.sin(rad); const prof = document.getElementById('rotCityProf'); if(prof) { prof.setAttribute('cx', cx); prof.setAttribute('cy', cy); prof.setAttribute('opacity', (Math.sin(rad)>0)?1:0.5); } }
    function check3(){ var v=document.getElementById('rotAns').value, st=document.getElementById('st3'); st.style.display="block"; if(v==='24') { st.innerHTML="‚úÖ CORRECT !"; st.style.color="var(--success)"; } else { st.innerHTML="‚ùå R√âESSAIE."; st.style.color="var(--error)"; } }
    
    const REVOLUTION_DAYS = 365; let revDay = 0; let revPlaying = false; let revRaf = 0; let revLastTs = 0;
    function initQ4(){ renderRev(); }
    function renderRev(){ const lbl = document.getElementById('revDayLbl'); if(lbl) lbl.textContent = 'Jour : ' + Math.floor(revDay); const orbit = document.getElementById('q5Orbit'); const earth = document.getElementById('q5Earth'); if(orbit) orbit.style.transform = 'rotate(' + (revDay / REVOLUTION_DAYS) * (Math.PI * 2) + 'rad)'; if(earth) earth.style.transform = 'translateX(var(--r)) rotate(' + (revDay / 6) * (Math.PI * 2) + 'rad)'; }
    function toggleRevPlay(){ revPlaying = !revPlaying; document.getElementById('revPlayBtn').textContent = revPlaying ? '‚è∏ Pause' : '‚ñ∂Ô∏é Play'; if(revPlaying){ revLastTs = 0; revRaf = requestAnimationFrame(revTick); } else { cancelAnimationFrame(revRaf); } }
    function revTick(ts){ if(!revPlaying) return; if(!revLastTs) revLastTs = ts; revDay += (ts - revLastTs) / 1000 * 20; revLastTs = ts; if(revDay >= REVOLUTION_DAYS){ revDay = REVOLUTION_DAYS; toggleRevPlay(); } renderRev(); revRaf = requestAnimationFrame(revTick); }
    function resetRev(){ revDay=0; renderRev(); if(revPlaying) toggleRevPlay(); }
    function checkRev(){ const n=document.getElementById('revAns').value; const u=document.getElementById('revUnit').value; const ok = (u==='jour' && Math.abs(n-365)<=10) || (u==='annees' && Math.abs(n-1)<=0.1); document.getElementById('st4').innerHTML = ok ? "<span style='color:#4ade80'>‚úÖ Correct : 365 jours</span>" : "<span style='color:#f87171'>‚ùå R√©essaie.</span>"; document.getElementById('st4').style.display = "block"; }
    function addRevDay(d){ revDay=(revDay+d)%366; renderRev(); }
    function toggleRevAccel(){ /* No implementation needed for this specific request, keeps layout */ }

    // --- Q5 ---
    function setRevMini(deg){ const t=deg*Math.PI/180; const x=260 + 170*Math.cos(t); const y=130 + 90*Math.sin(t); const g = document.getElementById('revMiniG'); if(g) g.setAttribute('transform','translate('+x.toFixed(1)+' '+y.toFixed(1)+')'); }
    function checkQ5(){ var r=document.querySelector('input[name="q5"]:checked'), st=document.getElementById('statusQ5'); st.style.display="block"; st.innerHTML = (r && r.value==="revolution") ? "‚úÖ Correct !" : "‚ùå Incorrect."; st.style.color=(r && r.value==="revolution")?"#4ade80":"#f87171"; }

    // --- Q6 ---
    function initQ6() { setModHour(0); }
    function setModHour(h){
        h=Number(h); document.getElementById('modLbl').textContent='Heure : '+h;
        const earth=document.getElementById('q7Earth'); const mk=document.getElementById('q7Marker');
        if(earth && mk){
            const t = (h/24)*Math.PI*2; 
            earth.style.setProperty('--bx', ((-(h/24)*100) % 100).toFixed(2) + '%');
            const x = 110 + Math.cos(t)*88; const y = (110 - 44) + Math.sin(t)*22;
            mk.style.left = (x/220*100) + '%'; mk.style.top  = (y/220*100) + '%';
            mk.style.opacity = (Math.sin(t)+1)*0.35 + 0.3;
        }
    }
    function addMod(d){ var r=document.getElementById('modHour'); r.value=(Number(r.value)+d)%25; setModHour(r.value); }
    function checkQ6() { var r=document.querySelector('input[name="q6"]:checked'), fb=document.getElementById('fb6'); fb.style.display="block"; fb.innerHTML=(r && r.value==="jour_nuit")?"‚úÖ CORRECT !":"‚ùå FAUX."; fb.style.color=(r && r.value==="jour_nuit")?"#4ade80":"#f87171"; }

    // --- Q7 IMPORT√â DU INDEX.HTML ---
    function initQ7(){
      const tex = document.getElementById('q8tex');
      const madrid = document.getElementById('q8madrid');
      const sydney = document.getElementById('q8sydney');
      const speedLbl = document.getElementById('q8speedLbl');
      const startBtn = document.getElementById('q8startBtn');
      const speed2Btn = document.getElementById('q8speed2Btn');

      if(!tex || !madrid || !sydney) return;

      const R = 150, CX = 150, CY = 150;
      const cities = [
        { el: madrid, lat: 40.4, lon: -3.7 },
        { el: sydney, lat: -33.9, lon: 151.2 }
      ];

      let running = false;
      let speedMult = 1;     
      const omega = 12;      
      let rotDeg = 0;
      let last = performance.now();

      function project(latDeg, lonDeg){
        const lat = latDeg * Math.PI/180;
        const lon = lonDeg * Math.PI/180;
        const x = Math.cos(lat) * Math.sin(lon);
        const y = Math.sin(lat);
        const z = Math.cos(lat) * Math.cos(lon);
        const px = CX + R * x;
        const py = CY - R * y;
        return {px, py, z};
      }

      function render(){
        const bx = (-(rotDeg/360)*100) % 100;
        tex.style.setProperty('--bx', bx.toFixed(2) + '%');

        for(const c of cities){
          const lon = c.lon + rotDeg;
          const p = project(c.lat, lon);
          c.el.style.left = p.px.toFixed(1) + 'px';
          c.el.style.top  = p.py.toFixed(1) + 'px';

          if(p.z < 0){
            c.el.style.opacity = '0.35';
            c.el.style.filter = 'blur(0.8px)';
          }else{
            c.el.style.opacity = '1';
            c.el.style.filter = 'none';
          }
        }
      }

      function updateUI(){
        if(speedLbl) speedLbl.textContent = 'Vitesse : √ó' + speedMult;
        if(startBtn) startBtn.textContent = running ? 'Pause' : 'D√©marrer la rotation';
      }

      function tick(now){
        const dt = (now - last)/900;
        last = now;
        if(running){
          rotDeg = (rotDeg + omega * speedMult * dt) % 360;
          render();
        }
        requestAnimationFrame(tick);
      }

      if(startBtn) startBtn.addEventListener('click', ()=>{ running = !running; updateUI(); });
      if(speed2Btn) speed2Btn.addEventListener('click', ()=>{ speedMult = (speedMult === 1) ? 2 : 1; updateUI(); });

      render();
      updateUI();
      requestAnimationFrame(tick);
    }
    
    function corrigerQ8(){ var s=0; if(getChecked('q8q1')=='v')s++; if(getChecked('q8q2')=='f')s++; if(getChecked('q8q3')=='v')s++; document.getElementById('resQ8').textContent = (s===3) ? "‚úÖ Bravo !" : "Score : "+s+"/3"; }

    // --- Q8 ---
    function setT(t){ document.getElementById('tSel').textContent=t+' h'; document.getElementById('tG').setAttribute('transform','translate(380 130) rotate('+(t/24*360)+')'); }
    function checkT(){ var m=getChecked('m_t'), s=getChecked('s_t'); var ok = (document.getElementById('tSel').textContent.includes('0 h') && m=='jour' && s=='nuit'); document.getElementById('st8').innerHTML=ok?"‚úÖ Correct":"‚ùå V√©rifie 0h"; document.getElementById('st8').style.display='block'; }

    // --- Q9 IMPORT√â DU INDEX.HTML ---
    function initQ9(){
      const tex = document.getElementById('q10Tex');
      const elA = document.getElementById('q10A');
      const elB = document.getElementById('q10B');
      const elC = document.getElementById('q10C');
      const lblState = document.getElementById('q10State');
      const lblTime  = document.getElementById('q10Time');
      const btnPlus6 = document.getElementById('q10Plus6');
      const btnReset = document.getElementById('q10Reset');
      const btnCheck = document.getElementById('q10Check');
      const res = document.getElementById('q10Res');

      if(!tex) return; 

      const R = 120, CX = 120, CY = 120;
      const points = [
        {name:'A', el: elA, lat: 30, lon: 140},
        {name:'B', el: elB, lat: -20, lon: -110},
        {name:'C', el: elC, lat: -25, lon: 50},
      ];

      let running = false;
      let rotDeg = 0;
      let hours = 0;

      function setLabels(){
        lblTime.textContent = 't = ' + hours + ' h';
        lblState.textContent = (hours === 0) ? 'Situation 1' : 'Situation 2';
      }

      function project(latDeg, lonDeg){
        const lat = latDeg * Math.PI/180;
        const lon = lonDeg * Math.PI/180;
        const x = Math.cos(lat) * Math.sin(lon);
        const y = Math.sin(lat);
        const z = Math.cos(lat) * Math.cos(lon);
        const px = CX + R * x;
        const py = CY - R * y;
        return {px, py, z};
      }

      function placePoints(){
        const bx = (-(rotDeg/360)*100) % 100;
        tex.style.setProperty('--bx', bx.toFixed(2) + '%');

        for(const p0 of points){
          const lon = p0.lon + rotDeg;
          const p = project(p0.lat, lon);
          p0.el.style.left = p.px.toFixed(1) + 'px';
          p0.el.style.top  = p.py.toFixed(1) + 'px';
          p0.el.style.opacity = '1';
          p0.el.style.filter = 'none';
          const day = (p.px < CX);
          p0.el.style.background = day ? '#22c55e' : '#111827';
        }
      }

      function plus6h(){ hours = 6; rotDeg = (rotDeg + 90) % 360; setLabels(); placePoints(); }
      function reset(){ hours = 0; rotDeg = 0; setLabels(); placePoints(); }

      function corriger(){
         let score = 0;
         const getVal = (n) => { const el = document.querySelector('input[name="'+n+'"]:checked'); return el?el.value:null; };
         if(getVal('q10_s1_a') === 'nuit') score++;
         if(getVal('q10_s1_b') === 'jour') score++;
         if(getVal('q10_s1_c') === 'nuit') score++;
         if(getVal('q10_s2_a') === 'jour') score++;
         if(getVal('q10_s2_b') === 'nuit') score++;
         if(getVal('q10_s2_c') === 'nuit') score++;
         if(getVal('q10_tour') === '24') score++;

         if(score === 7) {
             res.innerHTML = "‚úÖ Bravo ! Tout est correct."; res.style.color = "#4ade80";
         } else {
             res.innerHTML = "‚ùå Tu as " + score + "/7 bonnes r√©ponses."; res.style.color = "#f87171";
         }
      }

      btnPlus6.onclick = plus6h;
      btnReset.onclick = reset;
      btnCheck.onclick = corriger;

      setLabels();
      placePoints();
    }

    function getChecked(n){ const e=document.querySelector('input[name="'+n+'"]:checked'); return e?e.value:null; }
    window.addEventListener('resize', () => { 
        if(typeof onResize1 === 'function') onResize1(); 
        if(typeof onResize2 === 'function') onResize2(); 
    });
    window.onload = () => { showStep(1); };
</script>
</body>
</html>
