<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<title>6e ‚Ä¢ Ombres + Rotation/R√©volution ‚Ä¢ (HTML)</title>
<style>
  :root{
    --bg:#0b1020; --ink:#eef2ff; --muted:#b8c1ff;
    --line:rgba(255,255,255,.12);
    --accent:#60a5fa;
    --shadow:0 14px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    -webkit-text-size-adjust:100%;
    overscroll-behavior:none;

    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:radial-gradient(1200px 800px at 10% 10%, #13204a, var(--bg));
    color:var(--ink);
  }
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter:blur(10px);
    background:rgba(11,16,32,.78);
    border-bottom:1px solid var(--line);
  }
  .bar{display:flex; align-items:center; gap:12px; padding:10px 14px;}
  .pill{padding:6px 10px; border:1px solid var(--line); border-radius:999px; color:var(--muted); font-size:13px}
#revDayLbl{font-size:22px; font-weight:900; padding:10px 16px; color:#fff;}
  /* Q3 : afficher l'heure en plus grand */
  #rotHourLbl{font-size:22px; padding:8px 14px; color:#fff; border-color:rgba(255,255,255,.22)}
#modLbl{font-size:22px; font-weight:900; padding:10px 16px; color:#fff;}
  .progress{flex:1; height:10px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden}
  .progress>div{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), #a78bfa);}
  .navbtn{
    appearance:none; border:1px solid var(--line);
    background:rgba(255,255,255,.06); color:var(--ink);
    padding:8px 12px; border-radius:12px; font-weight:650;
  }

  main{max-width:980px; margin:0 auto; padding:14px 14px 80px;}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid var(--line);
    border-radius:22px;
    padding:16px;
    box-shadow:var(--shadow);
  }
  h1{margin:0 0 6px; font-size:22px}
  h2{margin:0 0 10px; font-size:18px}
  h3{margin:0 0 8px}
  p{margin:10px 0; color:var(--muted); line-height:1.35}

  .grid2{display:grid; grid-template-columns:1.1fr .9fr; gap:14px}
  @media (max-width:820px){ .grid2{grid-template-columns:1fr;} }

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .tag{
    display:inline-block; padding:4px 10px;
    border-radius:999px; border:1px solid var(--line);
    color:var(--muted); font-size:12px;
  }
  .btn{
    appearance:none; border:1px solid var(--line);
    background:rgba(255,255,255,.08); color:var(--ink);
    padding:10px 12px; border-radius:14px; font-weight:700;
  }
  .btn.primary{
    background:linear-gradient(90deg, rgba(96,165,250,.28), rgba(167,139,250,.20));
    border-color:rgba(96,165,250,.4);
  }
  .btn.ok{border-color:rgba(34,197,94,.55)}

  .hint,.corr{
    display:none; margin-top:10px; padding:10px 12px; border-radius:16px;
    border:1px dashed var(--line); background:rgba(255,255,255,.04);
  }
  .hint strong,.corr strong{color:var(--ink)}

  .imgbox{border-radius:18px; overflow:hidden; border:1px solid var(--line); background:#0a0f22}
  .imgbox img{display:block; width:100%; height:auto}

  /* Zones de d√©p√¥t tr√®s visibles */
  .dropzone{
    min-height:56px; padding:10px;
    border:3px dashed rgba(255,255,255,.65);
    border-radius:16px;
    background:rgba(255,255,255,.18);
  }
  .dzlabel{
    font-size:13px; font-weight:800;
    color:#000; /* ‚úÖ noir */
    background:rgba(255,255,255,.78);
    display:inline-block;
    padding:4px 8px;
    border-radius:999px;
    margin-bottom:6px;
  }

  .draggables{display:flex; gap:10px; flex-wrap:wrap}
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 12px; border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.06);
    color:var(--ink); font-weight:750;
    touch-action:none; user-select:none;
  }
  .chip[data-placed="1"]{opacity:.55}
  .chip .dot{width:10px; height:10px; border-radius:50%; background:var(--accent)}
  .chip.floating{position:fixed; z-index:1000; box-shadow:0 16px 48px rgba(0,0,0,.45)}

  .mcq{display:grid; gap:10px}
  .opt{
    display:flex; gap:10px; align-items:flex-start;
    padding:10px 12px; border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04)
  }
  .opt input{transform:scale(1.2); margin-top:2px}

  .status{
    margin-top:10px; padding:10px 12px; border-radius:16px;
    border:1px solid var(--line);
    background:rgba(255,255,255,.04);
    display:none;
  }
  .status.ok{border-color:rgba(34,197,94,.55)}
  .status.bad{border-color:rgba(239,68,68,.55)}

  .step{display:none}
  .step.active{display:block}

  .animWrap{
    border:1px solid var(--line);
    border-radius:18px;
    background:rgba(0,0,0,.18);
    padding:10px;
  }
  svg{max-width:100%}
  .sliderRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px}
  input[type="range"]{width:280px}

  .inputNum{
    padding:12px 12px; border-radius:14px; border:1px solid var(--line);
    background:rgba(255,255,255,.04); color:var(--ink);
    width:140px; font-size:16px;
  }
  select{background:#fff;color:#000;border:1px solid #cfcfcf;font-weight:800}

  table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:18px; border:1px solid var(--line)}
  th,td{padding:10px 10px; border-bottom:1px solid var(--line)}
  th{text-align:left; color:var(--muted); background:rgba(255,255,255,.04)}
  tr:last-child td{border-bottom:none}
  .center{text-align:center}

  .footnav{
    position:fixed; bottom:0; left:0; right:0; z-index:12;
    background:rgba(11,16,32,.82);
    backdrop-filter:blur(10px);
    border-top:1px solid var(--line);
    padding:10px 14px;
  }
  .footnav .row{max-width:980px; margin:0 auto; justify-content:space-between}

/* ===== Q5 (STEP s5) : nouvelle animation r√©volution (div) ===== */
#s5 .animWrap{ min-height: 340px; }

.q5rev-space{
  position:relative;
  width:100%;
  height:320px;
  max-width:520px;
  margin:6px auto 0;
}

.q5rev-space{
  --r:130px; /* rayon de l'orbite */
}

.q5rev-orbit-path{
  position:absolute;
  left:50%; top:50%;
  width:calc(var(--r) * 2);
  height:calc(var(--r) * 2);
  margin-left:calc(var(--r) * -1);
  margin-top: calc(var(--r) * -1);
  border-radius:50%;
  border:2px solid rgba(255,255,255,.45);
}

.q5rev-sun{
  position:absolute;
  left:50%; top:50%;
  width:60px; height:60px;
  margin-left:-30px; margin-top:-30px;
  border-radius:50%;
  background:radial-gradient(circle at 35% 35%, #fff6a0, #ff9a00);
  box-shadow:0 0 22px rgba(255,170,0,.6);
}

.q5rev-flag{
  position:absolute;
  left:50%; top:50%;
  transform:translate(var(--r), -14px);
  font-size:20px;
  user-select:none;
}

.q5rev-orbit{
  position:absolute;
  left:50%; top:50%;
  width:0; height:0;
}

.q5rev-earth{
  position:absolute;
  left:0; top:0;
  width:36px; height:36px;
  border-radius:50%;
  transform:translateX(var(--r));
  background:radial-gradient(circle at 30% 30%, #bfe7ff, #1e4fd8);
  box-shadow:0 0 10px rgba(110,170,255,.4);
}
.q5rev-earth::after{
  content:"";
  position:absolute;
  left:50%; top:0;
  width:2px; height:100%;
  margin-left:-1px;
  background:rgba(255,255,255,.7);
}


/* === Q7 : animation globe illustr√© (remplace l'ancien SVG) === */
.q7stage {
  position:relative;
  width:640px; height:280px;
  margin:0 auto;
}
.q7sun {
  position:absolute; left:48px; top:92px;
  width:90px; height:90px; border-radius:50%;
  background:radial-gradient(circle,#ffe9a3,#f59e0b 70%);
  box-shadow:0 0 28px rgba(245,158,11,.55);
}
.q7ray {
  position:absolute; left:132px; top:70px;
  width:220px; height:140px;
  clip-path:polygon(0 50%,100% 0,100% 100%);
  background:linear-gradient(90deg,rgba(255,233,163,.35),rgba(255,233,163,.06));
  pointer-events:none;
}
.q7earth {
  position:absolute; left:320px; top:40px;
  width:200px; height:200px; border-radius:50%;
  overflow:hidden;
  border:2px solid rgba(0,0,0,.30);
  box-shadow:0 14px 26px rgba(0,0,0,.35);
  background:#1f6f8b;
  --bx:0%;
}
.q7surf {
  position:absolute; inset:-10%;
  width:140%; height:120%;
  background-image:url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22900%22%20height%3D%22450%22%20viewBox%3D%220%200%20900%20450%22%3E%0A%3Crect%20width%3D%22900%22%20height%3D%22450%22%20fill%3D%22%231f6f8b%22/%3E%0A%3Cg%20fill%3D%22%2363c76a%22%20opacity%3D%220.95%22%3E%0A%20%20%3Cpath%20d%3D%22M95%2C135%20C140%2C80%20235%2C70%20280%2C125%20C310%2C165%20285%2C210%20230%2C230%20C165%2C250%20110%2C220%2090%2C175%20C80%2C160%2082%2C150%2095%2C135%20Z%22/%3E%0A%20%20%3Cpath%20d%3D%22M285%2C255%20C320%2C220%20375%2C215%20410%2C240%20C450%2C270%20445%2C320%20400%2C340%20C355%2C360%20320%2C345%20295%2C315%20C275%2C290%20270%2C272%20285%2C255%20Z%22/%3E%0A%20%20%3Cpath%20d%3D%22M430%2C95%20C485%2C55%20575%2C55%20635%2C105%20C690%2C150%20680%2C215%20630%2C250%20C570%2C295%20495%2C285%20455%2C245%20C415%2C200%20405%2C135%20430%2C95%20Z%22/%3E%0A%20%20%3Cpath%20d%3D%22M650%2C275%20C705%2C235%20815%2C235%20865%2C285%20C900%2C320%20890%2C375%20835%2C400%20C770%2C430%20690%2C415%20650%2C375%20C620%2C345%20615%2C300%20650%2C275%20Z%22/%3E%0A%20%20%3Cpath%20d%3D%22M690%2C125%20C725%2C100%20780%2C100%20815%2C125%20C845%2C145%20835%2C180%20805%2C195%20C770%2C215%20725%2C205%20700%2C182%20C675%2C160%20668%2C140%20690%2C125%20Z%22/%3E%0A%3C/g%3E%0A%3Cg%20fill%3D%22%23ffffff%22%20opacity%3D%220.35%22%3E%0A%20%20%3Cellipse%20cx%3D%22180%22%20cy%3D%2270%22%20rx%3D%2256%22%20ry%3D%2220%22/%3E%0A%20%20%3Cellipse%20cx%3D%22470%22%20cy%3D%2255%22%20rx%3D%2272%22%20ry%3D%2222%22/%3E%0A%20%20%3Cellipse%20cx%3D%22735%22%20cy%3D%2280%22%20rx%3D%2264%22%20ry%3D%2220%22/%3E%0A%20%20%3Cellipse%20cx%3D%22600%22%20cy%3D%22190%22%20rx%3D%2280%22%20ry%3D%2224%22/%3E%0A%20%20%3Cellipse%20cx%3D%22295%22%20cy%3D%22365%22%20rx%3D%2288%22%20ry%3D%2226%22/%3E%0A%3C/g%3E%0A%3C/svg%3E');
  background-size:220% 100%;
  background-repeat:repeat-x;
  background-position: var(--bx) 50%;
  transform: translateX(-10%);
  filter:saturate(1.05) contrast(1.05);
}
.q7shine {
  position:absolute; inset:0;
  background:radial-gradient(circle at 35% 40%,
    rgba(255,255,255,.45) 0%,
    rgba(255,255,255,.12) 35%,
    rgba(0,0,0,.18) 70%,
    rgba(0,0,0,.35) 100%);
  mix-blend-mode:overlay;
  pointer-events:none;
}
.q7night {
  position:absolute; inset:0;
  width:160%; height:100%;
  left:-30%;
  background:linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(0,0,0,0) 48.8%,
    rgba(0,0,0,.88) 51.2%,
    rgba(0,0,0,.90) 100%);
  mix-blend-mode:multiply;
  pointer-events:none;
}
.q7equator {
  position:absolute; left:-10%; top:50%;
  width:120%; height:2px;
  background:rgba(255,255,255,.22);
  transform:translateY(-50%);
  pointer-events:none;
}
.q7track {
  position:absolute; inset:0;
  pointer-events:none;
}
.q7track svg { width:100%; height:100%; display:block; }
.q7tb { stroke:rgba(255,77,141,.30); stroke-width:3; stroke-dasharray:7 7; fill:none; }
.q7tfGlow { stroke:rgba(255,77,141,.22); stroke-width:10; fill:none; }
.q7tf { stroke:rgba(255,77,141,.85); stroke-width:4.5; fill:none; }

.q7marker {
  position:absolute;
  width:14px; height:14px; border-radius:50%;
  background:#ff4d8d;
  box-shadow:0 0 0 3px rgba(255,255,255,.9);
  transform:translate(-50%,-50%);
  left:50%; top:50%;
}
.q7labels {
  position:absolute; left:0; right:0; bottom:0;
  display:flex; justify-content:space-between; align-items:center;
  padding:0 10px;
  font-size:13px;
  color:rgba(255,255,255,.75);
}


  #s9 .q9consigne, #s9 .q10consigne{margin:10px 0 14px; color:rgba(255,255,255,.92); font-weight:800;}

#s9 .q10-terminator{
  position:absolute;
  top:0; bottom:0;
  left:50%;
  width:0;
  border-left:2px dashed rgba(255,255,255,0.7);
  pointer-events:none;
  z-index:5;
}


  html,body{height:100%;}
  body{ -webkit-text-size-adjust:100%; overscroll-behavior: none; }
  button, .btn, .navbtn{ touch-action: manipulation; }
  canvas{ touch-action:none; }

</style>

<style>
.ws-tip{
  margin:10px 0 12px;
  padding:10px 12px;
  border-radius:14px;
  background:rgba(255,255,255,.06);
  border:1px dashed rgba(255,255,255,.22);
  color:rgba(255,255,255,.92);
  font-weight:800;
  line-height:1.35;
}
.ws-tip strong{ font-weight:950; }
</style>

<style>
.wsModal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  display:grid; place-items:center;
  z-index:9999;
}
.wsModalCard{
  width:min(560px, 92vw);
  background:rgba(20,26,48,.98);
  color:#fff;
  border:1px solid rgba(255,255,255,.18);
  border-radius:18px;
  padding:16px 16px 12px;
  box-shadow:0 24px 80px rgba(0,0,0,.55);
}
.wsModalTitle{ font-weight:950; font-size:18px; margin-bottom:8px; }
.wsModalMsg{ font-size:16px; line-height:1.35; color:rgba(255,255,255,.92); }
.wsModalActions{ display:flex; justify-content:flex-end; margin-top:12px; }
</style>
  <script src="three.min.js"></script>
</head>
<body>
<header>
<div class="bar">
<div class="pill" id="pillStep">√âtape 0/9</div>
<div class="progress"><div id="prog"></div></div>
<button class="navbtn" id="btnHome">Accueil</button>
</div>
</header>
<main>
<!-- STEP 0 -->
<section class="card step active" id="s7">
<h1>Ombres &amp; mouvements de la Terre (6e) </h1>
<p>Tu vas faire une <strong>activit√© qui</strong> permettra de  <strong> comprendre l'alternance du jour et de la nuit</strong> avec des exercices interactifs et une <strong>correction automatique</strong>.</p>
<div class="row">
</div>
<div class="hint" style="display:block">
<strong>Conseil :</strong> Manipule toujours le mod√®le (curseur, boutons‚Ä¶) avant de r√©pondre.
    </div>
<div style="height:10px"></div>
<button id="startBtn" type="button" class="btn primary" onclick="go(1)">Commencer</button>

  

</section>
<!-- STEP 1 : ACTIVIT√â PROJECTEUR (AVANT Q1) -->
<section class="card step" id="s1">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 1 ‚Äî Activit√© d‚Äôobservation </h2>
</div>
<div class="hint" style="display:block">
<strong>Consignes :</strong><br/>
      1) Mets le projecteur au maximum (curseur tout √† droite).<br/>
      2) Observe l'√©clairage de la boule. Puis, √©claire la danseuse et de la Terre. Tout l'objet est-il √©clair√© ?
    </div>

<div class="animWrap" id="q1ModelWrap">
  <div class="row" style="justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
    <strong>Mod√®le</strong>
    <span class="pill" id="valBrightQ1">0%</span>
  </div>

  <div id="container-3d-q1" style="width:100%; height:600px; background:#000; border-radius:12px; position:relative; overflow:hidden; touch-action:none; border: 1px solid rgba(255,255,255,0.12);">
      <div id="labels-overlay-q1" style="position:absolute; bottom:15px; right:15px; pointer-events:none; display:none; z-index:5;">
          <span style="color:#60a5fa; font-weight:bold; font-size:0.9rem; background:rgba(0,0,0,0.78); padding:6px 12px; border-radius:6px; border:1px solid #60a5fa;">
            OMBRE PROPRE
          </span>
      </div>
  </div>

  <div style="padding:16px; background:rgba(255,255,255,0.03); display:flex; flex-direction:column; gap:14px; border-radius:12px; margin-top:12px;">
      <div style="background: rgba(0,0,0,0.22); padding: 14px; border-radius: 10px;">
          <label style="display:flex; justify-content:space-between; font-size:0.8rem; color:#b8c1ff; margin-bottom:12px; font-weight:800; letter-spacing:0.2px;">
              <span>PUISSANCE DU PROJECTEUR</span>
              <span id="valBrightTxtQ1" style="color:#60a5fa;">0%</span>
          </label>
          <input type="range" id="lightRangeQ1" min="0" max="2" step="0.1" value="0" style="width:100%; height:30px; cursor:pointer;">
          <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
            <button class="btn" id="btnMaxQ1" type="button">‚ö° Max</button>
            <button class="btn" id="btnCenterQ1" type="button">üéØ Objet au milieu</button>
            <button class="btn" id="btnResetQ1" type="button">‚Ü∫ R√©initialiser</button>
          </div>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px;">
          <button class="btn" id="btnBouleQ1" type="button" style="background:#6b7280;">‚ö™ BOULE</button>
          <button class="btn" id="btnStatueQ1" type="button" style="background:#444;">üíÉ DANSEUSE</button>
          <button class="btn" id="btnTerreQ1" type="button" style="background:#27ae60;">üåç TERRE</button>
      </div>

     
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
          <button class="btn" id="btnFreezeQ1" type="button" style="background:#0ea5e9;">‚è∏ Figer</button>
          <button class="btn" id="btnArrowQ1" type="button" style="background:#22c55e;">üéØ Trajet de la lumi√®re</button>
      </div>


     
  </div>
</div>



<script>
(function(){
  // D√©marrage robuste iPad/ENT :
  // - attend DOM pr√™t
  // - attend que THREE soit r√©ellement charg√©
  // - affiche un message explicite si three.min.js est introuvable/bloqu√©

  function $(id){ return document.getElementById(id); }

  function showMsg(html){
    var container = $('container-3d-q1');
    if(!container) return;
    container.innerHTML = '<div style="position:absolute;inset:0;display:grid;place-items:center;padding:18px;text-align:center;color:#eef2ff;font-weight:800;background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.85));">'
      + '<div style="max-width:520px;border:1px solid rgba(255,255,255,.16);border-radius:14px;padding:14px;background:rgba(255,255,255,.06);">'
      + html + '</div></div>';
  }

  function initQ1(){
    var container = $('container-3d-q1');
    if(!container) return;

    
    var rootQ1 = (container && container.closest) ? (container.closest('section') || document) : document;
// Si la section est cach√©e au chargement (souvent dans l'activit√© compl√®te),
    // le conteneur peut avoir une taille 0 -> canvas invisible. On attend une taille correcte.
    var tries = 0;
    function waitForSize(){
      var w = container.clientWidth || 0;
      var h = container.clientHeight || 0;
      if(w < 50 || h < 50){
        tries++;
        if(tries < 60){ setTimeout(waitForSize, 100); }
        return;
      }
      reallyInit(w, h);
    }

    function reallyInit(w0, h0){

    // UI
    var range = $('lightRangeQ1');
    var valBright = $('valBrightTxtQ1');
    var pill = $('valBrightQ1');
    var btnMax = $('btnMaxQ1');
    var btnCenter = $('btnCenterQ1');
    var btnReset = $('btnResetQ1');

    var btnBoule = $('btnBouleQ1');
    var btnStatue = $('btnStatueQ1');
    var btnTerre = $('btnTerreQ1');

    var toggleSelf = $('toggleSelfQ1');
    var toggleCast = $('toggleCastQ1');
    var btnDefi = $('btnDefiQ1');
    var btnFreeze = $('btnFreezeQ1');
    var btnArrow = $('btnArrowQ1');

    // Garde-fou : si certains √©l√©ments manquent, on √©vite un crash global
    if(!range || !valBright){
      showMsg('‚ùå Probl√®me d‚Äôinterface : √©l√©ments manquants (lightRangeQ1 / valBrightTxtQ1).');
      return;
    }

    // THREE dispo ?
    if(!window.THREE){
      showMsg('‚ùå <b>Three.js n\'est pas charg√©</b><br><br>'
        + '‚û°Ô∏è V√©rifie que <b>three.min.js</b> est dans <b>le m√™me dossier</b> que ce fichier HTML.<br>'
        + '‚û°Ô∏è Ouvre le HTML dans <b>Safari</b> (pas dans Aper√ßu).');
      return;
    }

    // --- SC√àNE ---
    var THREE = window.THREE;
    var scene = new THREE.Scene();

    var camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 2.5, 12);

    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
    var renderer = new THREE.WebGLRenderer({ antialias: !isIOS, powerPreference: "high-performance" });
    renderer.setPixelRatio(Math.min(1.25, window.devicePixelRatio || 1));
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFShadowMap;
    if(isIOS){
      // iPad Safari: gain de performance (ombres OK mais moins co√ªteuses)
      renderer.shadowMap.enabled = true;
    }
    container.appendChild(renderer.domElement);




    // ALIGNEMENT HORIZONTAL
    var h = 0.5;

    var spotLight = new THREE.SpotLight(0xffffff, 0);
    spotLight.position.set(-8, h, 0);
    spotLight.target.position.set(0, h, 0);
    spotLight.castShadow = true;
    spotLight.angle = 0.35;
    spotLight.penumbra = 0.0;
    spotLight.shadow.mapSize.set(1024, 1024);
    spotLight.shadow.bias = -0.0004;
    spotLight.shadow.normalBias = 0.03;
    scene.add(spotLight);
    scene.add(spotLight.target);

    var ambient = new THREE.AmbientLight(0xffffff, 0.05);
    scene.add(ambient);

    // --- MODE PERF AUTO (iPad/tablettes) ---
    // Objectif : garder l‚Äôombre (p√©dagogie) tout en r√©duisant le co√ªt graphique si la tablette rame.
    var PERF_ON = false;
    var _fpsFrames = 0;
    var _fpsT0 = (window.performance && performance.now) ? performance.now() : Date.now();

    function applyPerfMode(on){
      PERF_ON = !!on;

      // R√©solution de rendu (gros gain)
      var pr = PERF_ON ? 1 : Math.min(1.25, (window.devicePixelRatio || 1));
      renderer.setPixelRatio(pr);

      // Ombres : on les garde (important ici), mais on r√©duit leur co√ªt
      // - mapSize plus petite
      // - seules les ombres utiles restent actives
      var map = PERF_ON ? 512 : 1024;
      try{
        renderer.shadowMap.enabled = true;
        spotLight.castShadow = true;
        spotLight.shadow.mapSize.set(map, map);
      }catch(e){}

      // Couper les ombres d√©coratives (lampe, √©l√©ments non essentiels)
      scene.traverse(function(obj){
        if(!obj || !obj.isMesh) return;
        // On garde uniquement l‚Äôombre de l‚Äôobjet √©tudi√© + l‚Äô√©cran qui la re√ßoit
        if(obj === screen){
          obj.receiveShadow = true;
          obj.castShadow = false;
        }else if(currentObj && (obj === currentObj || (currentObj.children && currentObj.children.indexOf(obj)>=0))){
          obj.castShadow = true;
          obj.receiveShadow = false;
        }else{
          obj.castShadow = false;
          obj.receiveShadow = false;
        }
      });

      // Re-render imm√©diat
      renderer.render(scene, camera);
    }
    // LAMPE visible
    var lampGroup = new THREE.Group();
    var lampBody = new THREE.Mesh(
      new THREE.CylinderGeometry(0.35, 0.45, 1),
      new THREE.MeshStandardMaterial({ color: 0x333333 })
    );
    lampBody.rotation.z = Math.PI / 2;

    var lampLens = new THREE.Mesh(
      new THREE.SphereGeometry(0.3, 32, 32),
      new THREE.MeshBasicMaterial({ color: 0xffffaa, transparent: true, opacity: 0.15 })
    );
    lampLens.position.set(0.5, 0, 0);
    lampGroup.add(lampBody, lampLens);
    lampGroup.position.set(-8, h, 0);
    scene.add(lampGroup);

    // √âCRAN (clair pour voir l‚Äôombre)
    var screen = new THREE.Mesh(
      new THREE.PlaneGeometry(10, 10),
      new THREE.MeshStandardMaterial({ color: 0xdddddd })
    );
    screen.position.set(7, h, 0);
    screen.rotation.y = -Math.PI / 2;
    screen.receiveShadow = true;
    scene.add(screen);

    // --- Fl√®ches (trajet de la lumi√®re) ---
    var arrow1 = new THREE.ArrowHelper(
      new THREE.Vector3(1,0,0),
      new THREE.Vector3(-7.2, h, 0),
      4.5,
      0x60a5fa,
      0.4,
      0.25
    );
    var arrow2 = new THREE.ArrowHelper(
      new THREE.Vector3(1,0,0),
      new THREE.Vector3(-1.5, h, 0),
      5.5,
      0x60a5fa,
      0.4,
      0.25
    );
    arrow1.visible = false;
    arrow2.visible = false;
    scene.add(arrow1, arrow2);


    // OBJETS
    var currentObj = null;

    var skinMat = new THREE.MeshStandardMaterial({ color: 0xffdbac, roughness: 0.7 });
    var tutuMat = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.6, roughness: 0.9 });
    var earthMat = new THREE.MeshStandardMaterial({ color: 0x1a5fb4, roughness: 0.7 });
    var ballMat = new THREE.MeshStandardMaterial({ color: 0xdddddd, roughness: 0.6 });

    function createDanseuse(){
      var group = new THREE.Group();
      var head = new THREE.Mesh(new THREE.SphereGeometry(0.3), skinMat); head.position.y = 2.2;
      var body = new THREE.Mesh(new THREE.CylinderGeometry(0.22, 0.14, 0.9), skinMat); body.position.y = 1.35;
      var tutu = new THREE.Mesh(new THREE.CylinderGeometry(1.1, 1.1, 0.12, 32), tutuMat); tutu.position.y = 0.95;
      var legs = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.07, 1.7), skinMat); legs.position.y = 0.15;
      var arms = new THREE.Mesh(new THREE.TorusGeometry(0.45, 0.06, 16, 32, Math.PI), skinMat);
      arms.position.set(0, 2.0, 0); arms.rotation.z = Math.PI / 2;
      group.add(head, body, tutu, legs, arms);
      return group;
    }

    function createBoule(){
      var m = new THREE.Mesh(new THREE.SphereGeometry(1.5, 64, 64), ballMat);
      m.position.y = h;
      return m;
    }

    function createTerre(){
      var m = new THREE.Mesh(new THREE.SphereGeometry(1.5, 64, 64), earthMat);
      m.position.y = h;
      return m;
    }

    function setObj(type){
      if(currentObj) scene.remove(currentObj);

      if(type === 'boule'){
        currentObj = createBoule();
        lampLens.material.color.set(0xffffaa);
      } else if(type === 'statue'){
        currentObj = createDanseuse();
        currentObj.position.y = -0.5;
        lampLens.material.color.set(0xffffaa);
      } else {
        currentObj = createTerre();
        lampLens.material.color.set(0xffdd44);
      }

      currentObj.traverse(function(n){ if(n.isMesh) n.castShadow = true; });
      scene.add(currentObj);
    }

    // Par d√©faut : BOULE (verrouillage p√©dagogique)
    setObj('boule');

    // Activation initiale : sur iPad/tablette, on d√©marre en mode perf (ombre conserv√©e mais plus l√©g√®re)
    if(isIOS){ applyPerfMode(true); }

    camera.lookAt(1, h, 0);

    // √âtat ombres (verrouillage 3)
    var selfOn = true;
    var castOn = true;

    function setPower(v){
      var vv = isFinite(v) ? v : 0;
      // tr√®s visible sur iPad
      spotLight.intensity = vv * 300;
      valBright.textContent = Math.round(vv * 50) + "%";
      if(pill) pill.textContent = Math.round(vv * 50) + "%";
      lampLens.material.opacity = (vv <= 0.01) ? 0.05 : 0.95;
    }

    // Slider (iPad: input + change)
    range.addEventListener('input', function(e){ setPower(parseFloat(e.target.value)); });
    range.addEventListener('change', function(e){ setPower(parseFloat(e.target.value)); });
    setPower(parseFloat(range.value));

    if(btnMax) btnMax.addEventListener('click', function(){ range.value = "2"; setPower(2); });
    if(btnCenter) btnCenter.addEventListener('click', function(){
      // recentrer l'objet : on remet juste sa position (pour les objets group√©s aussi)
      if(currentObj){
        currentObj.position.set(0, (currentObj === null ? h : currentObj.position.y), 0);
      }
    });
    if(btnReset) btnReset.addEventListener('click', function(){
      range.value = "0";
      setPower(0);
      selfOn = true; castOn = true;
      ambient.intensity = 0.05;
      screen.receiveShadow = true;
      setObj('boule');
    
      freezeQ1 = false;
      if(btnFreeze) btnFreeze.textContent = '‚è∏ Figer';
      arrowsVisibleQ1 = false;
      arrow1.visible = arrow2.visible = false;
});

    if(btnBoule) btnBoule.addEventListener('click', function(){ setObj('boule'); });
    if(btnStatue) btnStatue.addEventListener('click', function(){ setObj('statue'); });
    if(btnTerre) btnTerre.addEventListener('click', function(){ setObj('terre'); });

    // --- API minimale pour la Question 2 (observer + glisser-d√©poser) ---
    window.Q1API = {
      setObj: setObj,
      setRange: function(v){
        try{ range.value = String(v); }catch(_){ }
        setPower(Number(v) || 0);
      },
      lock: function(on){
        var dis = !!on;
        var arr = [range, btnMax, btnCenter, btnStatue, btnTerre];
        for(var i=0;i<arr.length;i++){
          var el = arr[i];
          if(!el) continue;
          try{ el.disabled = dis; }catch(_){ }
          try{ el.style.opacity = dis ? '0.55' : '1'; }catch(_){ }
        }
      }
    };

    if(toggleSelf) toggleSelf.addEventListener('click', function(){
      selfOn = !selfOn;
      ambient.intensity = selfOn ? 0.05 : 0.9;
      toggleSelf.style.opacity = selfOn ? "1" : "0.5";
    });

    if(toggleCast) toggleCast.addEventListener('click', function(){
      castOn = !castOn;
      screen.receiveShadow = castOn;
      toggleCast.style.opacity = castOn ? "1" : "0.5";
    });

    

    function animate(){
      requestAnimationFrame(animate);
      if(currentObj && !freezeQ1) currentObj.rotation.y += 0.01;
            var tt = Date.now()*0.002;
      if(arrowsVisibleQ1){
        arrow1.setLength(4.5 + 0.3*Math.sin(tt));
        arrow2.setLength(5.5 + 0.3*Math.sin(tt + 1));
      }
      // --- Auto-perf : surveillance FPS (bascule si √ßa rame) ---
      _fpsFrames++;
      var _now = (window.performance && performance.now) ? performance.now() : Date.now();
      if(_now - _fpsT0 >= 1000){
        var fps = _fpsFrames;
        _fpsFrames = 0;
        _fpsT0 = _now;
        // Seuils simples : sur iPad, si < 25 fps -> perf ON ; si > 40 fps -> perf OFF
        if(isIOS){
          if(!PERF_ON && fps < 25) applyPerfMode(true);
          if(PERF_ON && fps > 40) applyPerfMode(false);
        }
      }
      renderer.render(scene, camera);
    }

    // --- Figer / Reprendre la rotation (verbalisation) ---
    var freezeQ1 = false;
    if(btnFreeze){
      btnFreeze.addEventListener('click', function(){
        freezeQ1 = !freezeQ1;
        btnFreeze.textContent = freezeQ1 ? '‚ñ∂ Reprendre' : '‚è∏ Figer';
      });
    }

    // --- Fl√®ches (trajet de la lumi√®re) ---
    var arrowsVisibleQ1 = false;
    if(btnArrow){
      btnArrow.addEventListener('click', function(){
        arrowsVisibleQ1 = !arrowsVisibleQ1;
        arrow1.visible = arrow2.visible = arrowsVisibleQ1;
      });
    }
    animate();

    window.addEventListener('resize', function(){
      if(!container) return;
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });
    }
    waitForSize();
  }

  // Attendre DOM + THREE (CDN/local parfois lent, iPad parfois retard)
  function waitForThree(attempt){
    if(attempt > 40){
      // ~8 secondes
      initQ1(); // initQ1 affichera le message d‚Äôerreur si THREE absent
      return;
    }
    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', function(){ waitForThree(attempt); }, { once:true });
      return;
    }
    if(window.THREE){
      initQ1();
      return;
    }
    setTimeout(function(){ waitForThree(attempt+1); }, 200);
  }

  waitForThree(0);
})();
</script>
<p><strong>Question :</strong> Tout l'objet est-il √©clair√© ?</p>
<div class="mcq">
<label class="opt"><input name="q0" type="radio" value="oui"/> Oui</label>
<label class="opt"><input name="q0" type="radio" value="non"/> Non</label>
</div>
<div class="status" id="st0"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkMCQ('q0','non','st0','Correct : une partie n‚Äôest pas √©clair√©e ‚Üí &lt;strong&gt;ombre propre&lt;/strong&gt;.')">Valider</button>
<button class="btn" onclick="toggle('c0')">Voir la correction</button>
<button class="btn ok" onclick="go(2)">Question 2 ‚Üí</button>
</div>
<div class="corr" id="c0">
<strong>Correction :</strong> Non. Une partie de la statuette est dans l‚Äô<strong>ombre propre</strong>.
    </div>
</section>
<!-- STEP 2 : Q2 Ombres  -->
<section class="card step" id="s2">
  <div class="row" style="justify-content:space-between; align-items:baseline">
    <h2>Question 2 ‚Äî Objet, ombre, ombre propre et ombre port√©e</h2>
  </div>

  <div class="hint" style="display:block">
    <strong>D√©finitions :</strong><br/>
    ‚Ä¢ <strong>Objet</strong> : ce qui bloque la lumi√®re (la <strong>boule</strong>).<br/>
    ‚Ä¢ <strong>Ombre</strong> : zone o√π la lumi√®re n‚Äôarrive pas, car elle est bloqu√©e.<br/>
    ‚Ä¢ <strong>Ombre propre</strong> : partie <strong>de l‚Äôobjet</strong> qui n‚Äôest pas √©clair√©e (sur l‚Äôobjet).<br/>
    ‚Ä¢ <strong>Ombre port√©e</strong> : ombre <strong>projet√©e sur un √©cran / le sol / un mur</strong>.
  </div>

  <div class="hint" style="display:block">
    <strong>Consigne :</strong><br/>
    1) Observe la <strong>boule</strong> √©clair√©e .<br/>
2) Fais glisser les √©tiquettes pour rep√©rer sur l'animation : <strong>l'objet</strong>, <strong>l'ombre propre</strong> et <strong>l'ombre port√©e</strong>.

  </div>

  <!-- üõ† Mode placement des zones (enseignant) -->
  


  <div class="grid2">

    <!-- Animation reprise de la question 1 (m√™me mod√®le, d√©plac√© ici automatiquement) -->
    <div class="animWrap" id="q2AnimWrap" style="position:relative; width:820px; height:432px; overflow:hidden;">
      <div id="q2Stage" style="position:relative; width:1000px; height:540px; transform:scale(0.82); transform-origin: top left;">

      <div id="q2ModelHost"></div>

      <!-- Zones de d√©p√¥t (au-dessus du mod√®le) -->
      <div class="dropzone" id="dz1" data-accept="objet"
           style="position:absolute; left:350px; top:455px; width:220px; min-height:60px;">
        <div class="dzlabel">Zone 1</div><div class="placed"></div>
      </div>

      <div class="dropzone" id="dz2" data-accept="ombre_propre" style="position:absolute; left:480px; top:312px; width:220px; min-height:60px;">
        <div class="dzlabel">Zone 2</div><div class="placed"></div>
      </div>

      <div id="q2ScreenHint" style="position:absolute; left:70%; top:4%; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:900; background:rgba(255,255,255,.80); color:#000; border:1px solid rgba(0,0,0,.18);">√âcran</div>

      <div class="dropzone" id="dz3" data-accept="ombre_portee" style="position:absolute; left:720px; top:409px; width:240px; min-height:60px;">
        <div class="dzlabel">Zone 3</div><div class="placed"></div>
      </div>
    
      </div>
</div>

    <!-- √âtiquettes + validation -->
    <div>
      <div class="draggables" id="q2Chips"></div>
      <div class="status" id="stQ2"></div>

      <div class="row" style="margin-top:10px">
        <button class="btn primary" onclick="checkQ2()">Valider</button>
        <button class="btn" onclick="toggle('hQ2')">Indice</button>
        <button class="btn" onclick="toggle('cQ2')">Voir la correction</button>
        <button class="btn" onclick="resetQ2()">Recommencer</button>
        <button class="btn ok" onclick="next()">Question 3 ‚Üí</button>
      </div>

      <div class="hint" id="hQ2" style="display:none">
        <strong>Indice :</strong> ombre port√©e = sur l‚Äô√©cran (mur/sol) ; ombre propre = sur l‚Äôobjet.
      </div>
      <div class="corr" id="cQ2" style="display:none">
        <strong>Correction :</strong> Zone 1 = objet ; Zone 2 = ombre propre ; Zone 3 = ombre port√©e.
      </div>
    </div>

  </div>
</section>

<!-- STEP 3 : Q2 image labels (OK) -->

<!-- STEP 4 : Q3 Rotation (sans donner 24h dans la d√©finition) -->
<section class="card step" id="s3">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 3 ‚Äî Rotation de la Terre (d√©couvrir la p√©riode)</h2>
</div>
<div class="hint" style="display:block">
<strong>D√©finitions :</strong><br/>
      ‚Ä¢ <strong>P√©riode de rotation</strong> : dur√©e n√©cessaire √† la Terre pour faire <strong>un tour complet sur elle-m√™me</strong>.<br/>
      ‚Ä¢ <strong>R√©volution</strong> : mouvement de la Terre <strong>autour du Soleil</strong>.
    </div>

<div class="hint" style="display:block">
<strong>Consigne :</strong> Lis les d√©finitions. Puis, √† l‚Äôaide du curseur, fais tourner la Terre pour trouver sa p√©riode de rotation. R√©ponds ensuite √† la question ci-dessous.
</div>

<div style="height:10px"></div>
<p><strong>Question :</strong> Quelle est la <strong>p√©riode de rotation</strong> de la Terre ?</p>
<div class="row">
<input class="inputNum" id="rotAns" inputmode="numeric" placeholder="nombre">
<select id="rotUnit">
<option value="">unit√©</option>
<option value="s">s</option>
<option value="h">h</option>
<option value="jour">jour</option>
<option value="annees">ann√©es</option>
</select>
</input></div>
<div class="status" id="st3"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkRot()">Valider</button>
<button class="btn" onclick="toggle('h3')">Indice</button>
<button class="btn" onclick="toggle('c3')">Voir la correction</button>
<button class="btn ok" onclick="go(4)">Question 3 ‚Üí</button>
</div>
<div class="hint" id="h3"><strong>Indice :</strong> c‚Äôest la dur√©e d‚Äôun jour complet.</div>
<div class="corr" id="c3"><strong>Correction :</strong> Environ 24 h (‚âà 1 jour).</div>


<div style="height:12px"></div>
<div class="grid2">
<div class="animWrap">
<strong>Vue ‚Äúdessus‚Äù : rep√®res Est / Ouest</strong>
<svg aria-label="Rotation Terre dessus Est Ouest" role="img" viewbox="0 0 520 280">
<defs>
<radialgradient cx="50%" cy="50%" id="sunA" r="60%">
<stop offset="0%" stop-color="#ffe9a3"></stop><stop offset="100%" stop-color="#f59e0b"></stop>
</radialgradient>
</defs>
<circle cx="90" cy="140" fill="url(#sunA)" r="38"></circle>
<text fill="rgba(255,255,255,.7)" font-size="14" text-anchor="middle" x="90" y="210">Soleil</text>
<text fill="rgba(255,255,255,.9)" font-size="16" text-anchor="middle" x="300" y="30">Ouest</text>
<text fill="rgba(255,255,255,.9)" font-size="16" text-anchor="middle" x="440" y="30">Est</text>
<line stroke="rgba(255,255,255,.35)" stroke-width="3" x1="160" x2="210" y1="140" y2="140"></line>
<g id="rotTopG" transform="translate(340 150)">
<circle fill="#2dd4bf" opacity=".9" r="85"></circle>
<path d="M0,-85 A85,85 0 0,1 0,85 A85,85 0 0,1 0,-85 Z" fill="rgba(0,0,0,.45)"></path>
<line stroke="rgba(255,255,255,.35)" stroke-width="3" x1="0" x2="0" y1="-85" y2="85"></line>
<circle cx="0" cy="-70" fill="#ff4d8d" r="6" stroke="white" stroke-width="2"></circle>
<text fill="white" font-size="12" text-anchor="middle" x="0" y="-95">Point</text>
<!-- fl√®che sens de rotation (rep√®re visuel) -->
<path d="M-40,95 C-10,120 20,120 50,95" fill="none" stroke="rgba(255,255,255,.65)" stroke-width="3"></path>
<polygon fill="rgba(255,255,255,.65)" points="48,95 60,98 52,108"></polygon>
</g>
</svg>
<div class="sliderRow">
<span class="tag">Faire tourner</span>
<input id="rotHour" max="24" min="0" oninput="setRotHour(this.value)" step="1" type="range" value="0"/>
<span class="pill" id="rotHourLbl">0</span>
<span class="tag" style="background:rgba(255,255,255,.9); color:#000; font-weight:900">h</span>
</div>
</div>
<div class="animWrap">
<strong>Vue ‚Äúprofil‚Äù : rotation autour de l‚Äôaxe (√©quateur visible)</strong>
<svg aria-label="Rotation Terre profil avec √©quateur (rotation seule)" role="img" viewbox="0 0 520 280">
<defs>
<!-- IDs uniques (pas de conflit avec le reste du fichier) -->
<radialgradient cx="50%" cy="50%" id="sun_prof" r="60%">
<stop offset="0%" stop-color="#ffe9a3"></stop>
<stop offset="100%" stop-color="#f59e0b"></stop>
</radialgradient>
<radialgradient cx="35%" cy="30%" id="earth_prof" r="70%">
<stop offset="0%" stop-color="#7dd3fc"></stop>
<stop offset="100%" stop-color="#0ea5e9"></stop>
</radialgradient>
</defs>
<!-- Soleil fixe √† gauche -->
<circle cx="90" cy="140" fill="url(#sun_prof)" r="38"></circle>
<line stroke="rgba(255,255,255,.35)" stroke-width="3" x1="130" x2="200" y1="140" y2="140"></line>
<text fill="rgba(255,255,255,.7)" font-size="14" text-anchor="middle" x="90" y="210">Soleil</text>
<!-- Terre (profil) -->
<g transform="translate(340 140)">
<circle fill="url(#earth_prof)" opacity=".95" r="85"></circle>
<circle fill="none" r="85" stroke="rgba(255,255,255,.18)" stroke-width="2"></circle>
<!-- Nuit FIXE (Soleil √† gauche => moiti√© droite sombre) -->
<path d="M 0 -85 A 85 85 0 0 1 0 85 L 0 0 Z" fill="rgba(0,0,0,.45)"></path>
<!-- Axe fixe -->
<line stroke="rgba(255,255,255,.35)" stroke-width="3" x1="-8" x2="8" y1="-95" y2="95"></line>
<!-- √âquateur visible (arri√®re pointill√© + avant plein) -->
<!-- (ellipse en perspective : l'arri√®re = demi-ellipse du haut, l'avant = demi-ellipse du bas) -->
<path d="M -75 0 A 75 24 0 0 0 75 0" fill="none" stroke="rgba(255,255,255,.45)" stroke-dasharray="6 6" stroke-width="3"></path>
<path d="M -75 0 A 75 24 0 0 1 75 0" fill="none" stroke="rgba(255,255,255,.75)" stroke-width="3"></path>
<!-- Ville qui "fait le tour" de l'√©quateur (mouvement comme sur l'animation) -->
<circle cx="0" cy="24" fill="#60a5fa" id="rotCity_prof" r="6" stroke="white" stroke-width="2"></circle>
<text fill="white" font-size="12" id="rotCityLbl_prof" text-anchor="middle" x="0" y="46">Ville</text>
</g>
<text fill="rgba(255,255,255,.75)" font-size="13" text-anchor="middle" x="340" y="260">
      Rotation sur elle-m√™me (r√©volution non prise en compte)
    </text>
</svg>
</div>
<div style="height:10px"></div>
</div></section>
<!-- STEP 5 : Q4 R√©volution + distance + question dur√©e -->
<section class="card step" id="s3">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 4 ‚Äî R√©volution : la Terre autour du Soleil</h2>
</div>
<div class="hint" style="display:block">
<strong>Consigne :</strong> Appuie sur <strong>Play</strong> pour faire tourner la Terre et d√©terminer le temps qu‚Äôelle met pour faire un tour complet autour du Soleil.
</div>

<div class="grid2">
<div class="animWrap">
<div class="row" style="justify-content:space-between">
<strong>Mod√®le : Terre autour du Soleil</strong>
<span class="pill" id="revDayLbl">Jour : 0</span>
</div>
<div aria-label="R√©volution Terre Soleil (animation)" class="q5rev-space">
<div aria-hidden="true" class="q5rev-orbit-path"></div>
<div aria-hidden="true" class="q5rev-sun"></div>
<div aria-hidden="true" class="q5rev-flag">üö©</div>
<div class="q5rev-orbit" id="q5Orbit">
<div aria-hidden="true" class="q5rev-earth" id="q5Earth"></div>
</div>
</div>
<div class="sliderRow">
<span class="tag">Commande</span>
<button class="btn" id="revPlayBtn" onclick="toggleRevPlay()">‚ñ∂Ô∏é Play</button>
<button class="btn" id="revAccelBtn" onclick="toggleRevAccel()">üöÄ Acc√©l√©rer l‚Äôorbite</button>
<button class="btn" onclick="addRevDay(30)">+30 j</button>
<button class="btn" onclick="addRevDay(90)">+90 j</button>
<span class="tag" style="margin-left:auto">‚ö† √âchelle de temps non respect√©e</span>
</div>
</div>
<div class="animWrap">
<div class="hint" style="display:block">
<strong>Question :</strong> Combien de temps met la Terre pour faire un tour complet autour du Soleil ?
        </div>
<div class="row">
<input class="inputNum" id="revAns" inputmode="numeric" placeholder="nombre">
<select id="revUnit">
<option value="">unit√©</option>
<option value="s">s</option>
<option value="h">h</option>
<option value="jour">jour</option>
<option value="annees">ann√©es</option>
</select>
</input></div>
<div class="status" id="st4"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkRev()">Valider</button>
<button class="btn" onclick="toggle('h4')">Indice</button>
<button class="btn" onclick="toggle('c4')">Voir la correction</button>
<button class="btn ok" onclick="go(5)">Question 4 ‚Üí</button>
</div>
<div class="hint" id="h4"><strong>Indice :</strong> c‚Äôest la dur√©e d‚Äôune ann√©e.</div>
<div class="corr" id="c4"><strong>Correction :</strong> Environ 365 jours (‚âà 1 ann√©e).</div>
</div>
</div>
</section>
<!-- STEP 6 : Q5 nom du mouvement (avec animation) -->
<section class="card step" id="s3">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 5 ‚Äî Comment s‚Äôappelle le mouvement autour du Soleil ?</h2>
</div>
<div class="hint" style="display:block">
<strong>Rappel des d√©finitions :</strong><br>‚Ä¢ <strong>Rotation de la Terre</strong> : mouvement de la Terre sur elle‚Äëm√™me.<br>‚Ä¢ <strong>R√©volution de la Terre</strong> : mouvement de la Terre autour du Soleil.
</div>

<div class="grid2">
<div class="animWrap">
<strong>Animation simplifi√©e</strong>
<svg aria-label="R√©volution simple" role="img" viewbox="0 0 520 260">
<circle cx="260" cy="130" fill="rgba(255,211,77,.85)" r="40"></circle>
<ellipse cx="260" cy="130" fill="none" rx="170" ry="90" stroke="rgba(255,255,255,.25)" stroke-width="3"></ellipse>
<g id="revMiniG" transform="translate(430 130)">
<circle fill="#2dd4bf" opacity=".95" r="18"></circle>
</g>
</svg>
<div class="sliderRow">
<span class="tag">Position</span>
<input id="revMini" max="360" min="0" oninput="setRevMini(this.value)" step="5" type="range" value="0"/>
</div>
</div>
<div>
<p>Comment s‚Äôappelle le mouvement de la Terre autour du Soleil ?</p>
<div class="mcq">
<label class="opt"><input name="q5" type="radio" value="rotation"/> Rotation</label>
<label class="opt"><input name="q5" type="radio" value="revolution"/> R√©volution</label>
<label class="opt"><input name="q5" type="radio" value="zigzag"/> Zigzag</label>
</div>
<div class="status" id="st5"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkMCQ('q5','revolution','st5','Correct : autour du Soleil = &lt;strong&gt;r√©volution&lt;/strong&gt;.')">Valider</button>
<button class="btn" onclick="toggle('c5')">Voir la correction</button>
<button class="btn ok" onclick="next()">Question 5 ‚Üí</button>
</div>
<div class="corr" id="c5"><strong>Correction :</strong> R√©volution.</div>
</div>
</div>
</section>
<!-- STEP 7 : Q6 comp√©tence mod√©lisation (animation) -->
<section class="card step" id="s3">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 6 ‚Äî Mod√©liser l‚Äôalternance jour / nuit</h2>
</div>
<div class="hint" style="display:block"><strong>Consigne :</strong> Fais tourner la Terre et observe le mouvement de la ville localis√©e par un point rouge. R√©ponds ensuite √† la question.</div>

<div class="grid2">
<div class="animWrap">
<div class="row" style="justify-content:space-between">
<strong>Boule √©clair√©e qui tourne</strong>
<span class="pill" id="modLbl">Heure : 0</span>
</div>
<!-- Animation Q7 (nouvelle) : globe illustr√© + trajectoire en perspective -->
<div aria-label="Mod√®le jour nuit" class="q7stage">
<div aria-hidden="true" class="q7sun"></div>
<div aria-hidden="true" class="q7ray"></div>
<div aria-label="Globe illustr√© avec alternance jour/nuit et rep√®re" class="q7earth" id="q7Earth" role="img">
<div aria-hidden="true" class="q7surf"></div>
<div aria-hidden="true" class="q7shine"></div>
<div aria-hidden="true" class="q7night"></div>
<div aria-hidden="true" class="q7equator"></div>
<div aria-hidden="true" class="q7track" id="q7Track">
<svg preserveaspectratio="none" viewbox="0 0 220 220">
<!-- arri√®re (haut) : pointill√© -->
<path class="q7tb" d="M 22 66 A 88 22 0 0 1 198 66"></path>
<!-- avant (bas) : plein + glow -->
<path class="q7tfGlow" d="M 198 66 A 88 22 0 0 1 22 66"></path>
<path class="q7tf" d="M 198 66 A 88 22 0 0 1 22 66"></path>
</svg>
</div>
<div class="q7marker" id="q7Marker" title="Ville"></div>
</div>
<div class="q7labels">
<span>Soleil</span>
<span>Face √©clair√©e = jour ‚Ä¢ Face sombre = nuit</span>
</div>
</div>
<div class="sliderRow">
<span class="tag">Tourner</span>
<input id="modHour" max="24" min="0" oninput="setModHour(this.value)" step="1" type="range" value="0"/>
<button class="btn" onclick="addMod(12)">+12 h</button>
</div>
</div>
<div>
<p><strong>Question :</strong> Quand la ville passe de la partie √©clair√©e √† la partie sombre, que se passe-t-il ?</p>
<div class="mcq">
<label class="opt"><input name="q6" type="radio" value="jour_nuit"/> Le lieu passe du jour √† la nuit.</label>
<label class="opt"><input name="q6" type="radio" value="ete_hiver"/> Le lieu passe de l‚Äô√©t√© √† l‚Äôhiver.</label>
<label class="opt"><input name="q6" type="radio" value="distance"/> La Terre s‚Äô√©loigne du Soleil.</label>
</div>
<div class="status" id="st6"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkMCQ('q6','jour_nuit','st6','Correct : la rotation explique l‚Äôalternance &lt;strong&gt;jour / nuit&lt;/strong&gt;.')">Valider</button>
<button class="btn" onclick="toggle('c6')">Voir la correction</button>
<button class="btn ok" onclick="next()">Question 6 ‚Üí</button>
</div>
<div class="corr" id="c6"><strong>Correction :</strong> Le lieu passe du jour √† la nuit.</div>
</div>
</div>
</section>
<!-- STEP 8 : Q7 Madrid/Sydney + animation -->
<section class="card step" id="q8Step"><div class="ws-tip" id="wsTipQ8" aria-live="polite">
  </div>

<style>
/* ===== Q8 scoped ===== */
#q8Step .q8wrap{ width:min(1100px, 96vw); margin:0 auto; }
#q8Step .q8card{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  padding:16px;
  box-shadow:0 18px 50px rgba(0,0,0,.35);
}
#q8Step .q8title{ font-weight:950; margin-bottom:6px; }
#q8Step .q8consigne{
  margin:8px 0 14px;
  color:rgba(255,255,255,.92);
  font-weight:800;
}
#q8Step .q8grid{
  display:flex;
  gap:16px;
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}
#q8Step .q8left{ flex: 1 1 420px; min-width: 320px; }
#q8Step .q8right{ flex: 0 0 360px; }
@media (max-width: 860px){
  #q8Step .q8right{ flex: 1 1 360px; }
}

/* Controls */
#q8Step .row{ display:flex; align-items:center; justify-content:flex-start; gap:10px; flex-wrap:wrap; }
#q8Step .pill{
  padding:7px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  font-weight:900;
  font-size:13px;
}
#q8Step .btn{
  padding:9px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
#q8Step .btn.primary{
  background:rgba(255,255,255,.10);
  border-color:rgba(255,255,255,.28);
}

/* ===== Globe ===== */
#q8Step .scene{ display:grid; place-items:center; padding:8px 0 6px; }
#q8Step .globe{
  width:300px; height:300px;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  background:#071027;
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 20px 60px rgba(0,0,0,.45);
}

/* Texture claire (oc√©ans bleus + continents verts) */
#q8Step .tex{
  position:absolute; inset:0;
  border-radius:50%;
  background-image:
    url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='512' viewBox='0 0 1024 512'>\
<defs>\
<linearGradient id='sea' x1='0' y1='0' x2='0' y2='1'>\
<stop offset='0' stop-color='%232a7be6'/>\
<stop offset='1' stop-color='%230a3b7a'/>\
</linearGradient>\
</defs>\
<rect width='1024' height='512' fill='url(%23sea)'/>\
<g opacity='0.25' fill='white'>\
<ellipse cx='120' cy='90' rx='90' ry='35'/>\
<ellipse cx='200' cy='130' rx='120' ry='45'/>\
<ellipse cx='720' cy='100' rx='140' ry='50'/>\
<ellipse cx='860' cy='160' rx='120' ry='45'/>\
</g>\
<g fill='%233bbf6a'>\
<path d='M150,260 C220,210 280,210 330,250 C350,275 360,315 330,340 C290,375 235,382 200,350 C175,330 150,310 135,295 Z'/>\
<path d='M410,190 C470,160 545,170 585,205 C615,230 620,265 590,285 C545,320 480,315 450,285 C430,265 405,235 400,220 Z'/>\
<path d='M610,255 C650,220 720,220 770,255 C800,275 805,315 775,335 C720,368 655,360 628,330 C610,312 595,285 600,272 Z'/>\
<path d='M840,300 C880,270 925,275 960,310 C980,330 985,360 960,380 C930,405 885,400 860,372 C840,350 830,330 832,315 Z'/>\
</g>\
</svg>");
  background-size:200% 100%;
  background-repeat:repeat-x;
  background-position: var(--bx, 0%) 50%;
  transform: translateZ(0);
}

/* Model√© sph√©rique */
#q8Step .sphere{
  position:absolute; inset:0;
  border-radius:50%;
  pointer-events:none;
  background:
    radial-gradient(circle at 30% 25%,
      rgba(255,255,255,.28) 0%,
      rgba(255,255,255,.10) 35%,
      rgba(255,255,255,0) 62%),
    radial-gradient(circle at 70% 75%,
      rgba(0,0,0,.10) 0%,
      rgba(0,0,0,.25) 55%,
      rgba(0,0,0,.40) 78%,
      rgba(0,0,0,.50) 100%);
  mix-blend-mode:multiply;
}

/* Jour/nuit */
#q8Step .daynight{
  position:absolute; inset:0;
  border-radius:50%;
  pointer-events:none;
  background: linear-gradient(to right,
    rgba(255,255,255,0.30) 0%,
    rgba(255,255,255,0.05) 35%,
    rgba(0,0,0,0.70) 52%,
    rgba(0,0,0,0.92) 68%,
    rgba(0,0,0,0.98) 100%);
  mix-blend-mode:multiply;
}

/* Villes */
#q8Step .city{
  position:absolute;
  width:12px; height:12px;
  border-radius:50%;
  background:#ef4444;
  border:2px solid #fff;
  box-shadow:0 0 0 3px rgba(0,0,0,.35), 0 0 14px rgba(239,68,68,.55);
  transform: translate(-50%,-50%);
  z-index:6;
}
#q8Step .city::after{
  content: attr(data-label);
  position:absolute;
  left: 14px; top: -6px;
  font-weight:900;
  font-size:12px;
  color:#fff;
  white-space:nowrap;
  text-shadow: 0 2px 8px rgba(0,0,0,.85);
}

/* QCM */
#q8Step .qcm p{ margin:6px 0 10px; color:rgba(255,255,255,.88); }
#q8Step .qcm .q{ margin:10px 0; padding:10px; border-radius:14px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); }
#q8Step .qcm label{ margin-right:14px; font-weight:800; }
#q8Step .qcm input{ transform: translateY(1px); }

#s9 .q10-terminator{
  position:absolute;
  top:0; bottom:0;
  left:50%;
  width:0;
  border-left:2px dashed rgba(255,255,255,0.7);
  pointer-events:none;
  z-index:5;
}

</style>
<div class="q8wrap">
<div class="q8card">
<div class="q8title">Question 7 ‚Äî Jour et nuit</div>
<div class="q8consigne">
<span style="opacity:.95">Consigne :</span>
      Clique sur <em>D√©marrer la rotation</em>, puis observe quand <strong>Madrid</strong> et <strong>Sydney</strong> sont du c√¥t√© √©clair√© (jour) ou du c√¥t√© sombre (nuit).
      Utilise <em>Vitesse √ó2</em> si besoin.
    </div>
<div class="q8grid">
<div class="q8left">
<div class="row" style="justify-content:space-between; margin-bottom:8px;">
<span class="pill" id="q8speedLbl">Vitesse : √ó1</span>
</div>
<div class="scene">
<div aria-label="Terre qui tourne avec alternance jour nuit" class="globe" role="img">
<div class="tex" id="q8tex"></div>
<div aria-hidden="true" class="sphere"></div>
<div aria-hidden="true" class="daynight"></div>
<div class="city" data-label="Madrid" id="q8madrid"></div>
<div class="city" data-label="Sydney" id="q8sydney"></div>
</div>
</div>
<div class="row" style="margin-top:10px;">
<button class="btn primary" id="q8startBtn" type="button">D√©marrer la rotation</button>
<button class="btn" id="q8speed2Btn" type="button">Vitesse √ó2</button>
</div>
</div>
<div class="q8right">
<div class="qcm">
<div style="font-weight:900; margin-bottom:6px">QCM ‚Äì Vrai / Faux</div>
<p>En observant l‚Äôanimation, indique si les affirmations suivantes sont vraies ou fausses.</p>
<div class="q">
            1. Quand <strong>Madrid</strong> est du c√¥t√© √©clair√© de la Terre, il fait jour √† Madrid.<br/>
<label><input name="q8q1" type="radio" value="v"/> Vrai</label>
<label><input name="q8q1" type="radio" value="f"/> Faux</label>
</div>
<div class="q">
            2. Quand <strong>Sydney</strong> est du c√¥t√© sombre de la Terre, il fait jour √† Sydney.<br/>
<label><input name="q8q2" type="radio" value="v"/> Vrai</label>
<label><input name="q8q2" type="radio" value="f"/> Faux</label>
</div>
<div class="q">
            3. La Terre tourne sur elle-m√™me, ce qui explique l‚Äôalternance du jour et de la nuit.<br/>
<label><input name="q8q3" type="radio" value="v"/> Vrai</label>
<label><input name="q8q3" type="radio" value="f"/> Faux</label>
</div>
<button class="btn primary" onclick="corrigerQ8()" type="button">Corriger</button>
<div id="resQ8" style="margin-top:8px; font-weight:900"></div>
</div>
</div>
</div>
</div>
</div>
<script>
(function(){
  const tex = document.getElementById('q8tex');
  const madrid = document.getElementById('q8madrid');
  const sydney = document.getElementById('q8sydney');
  const speedLbl = document.getElementById('q8speedLbl');
  const startBtn = document.getElementById('q8startBtn');
  const speed2Btn = document.getElementById('q8speed2Btn');

  if(!tex || !madrid || !sydney || !speedLbl || !startBtn || !speed2Btn) return;

  // Globe geometry (globe 300x300)
  const R = 150, CX = 150, CY = 150;

  // City coords
  const cities = [
    { el: madrid, lat: 40.4, lon: -3.7 },     // Madrid
    { el: sydney, lat: -33.9, lon: 151.2 }    // Sydney
  ];

  // Rotation
  let running = false;
  let speedMult = 1;     // √ó1 or √ó2
  const omega = 12;      // deg/s (base)
  let rotDeg = 0;
  let last = performance.now();

  function project(latDeg, lonDeg){
    const lat = latDeg * Math.PI/180;
    const lon = lonDeg * Math.PI/180;
    const x = Math.cos(lat) * Math.sin(lon);
    const y = Math.sin(lat);
    const z = Math.cos(lat) * Math.cos(lon);
    const px = CX + R * x;
    const py = CY - R * y;
    return {px, py, z};
  }

  function render(){
    // texture scroll
    const bx = (-(rotDeg/360)*100) % 100;
    tex.style.setProperty('--bx', bx.toFixed(2) + '%');

    for(const c of cities){
      const lon = c.lon + rotDeg;
      const p = project(c.lat, lon);
      c.el.style.left = p.px.toFixed(1) + 'px';
      c.el.style.top  = p.py.toFixed(1) + 'px';

      // behind globe: keep visible but lighter (as in your preference for Q10)
      if(p.z < 0){
        c.el.style.opacity = '0.35';
        c.el.style.filter = 'blur(0.8px)';
      }else{
        c.el.style.opacity = '1';
        c.el.style.filter = 'none';
      }
    }
  }

  function updateUI(){
    speedLbl.textContent = 'Vitesse : √ó' + speedMult;
    startBtn.textContent = running ? 'Pause' : 'D√©marrer la rotation';
  }

  function tick(now){
    const dt = (now - last)/900;
    last = now;

    if(running){
      rotDeg = (rotDeg + omega * speedMult * dt) % 360;
      render();
    }
    requestAnimationFrame(tick);
  }

  startBtn.addEventListener('click', ()=>{
    running = !running;
    updateUI();
  });

  speed2Btn.addEventListener('click', ()=>{
    speedMult = (speedMult === 1) ? 2 : 1;
    updateUI();
  });

  // init
  render();
  updateUI();
  requestAnimationFrame(tick);
})();
</script>
<script>
function corrigerQ8(){
  const rep = { q8q1:'v', q8q2:'f', q8q3:'v' };
  let score = 0, total = 3;
  for(const q in rep){
    const r = document.querySelector('input[name="'+q+'"]:checked');
    if(r && r.value === rep[q]) score++;
  }
  const res = document.getElementById('resQ8');
  if(!res) return;

  if(score === total){
    res.textContent = "‚úî Bravo ! Tout est correct.";
    res.style.color = "#22c55e";
  }else{
    res.textContent = "Score : " + score + " / " + total;
    res.style.color = "#fbbf24";
  }
}
</script>
</section>
<!-- STEP 9 : Q8 +12/+24 avec animation -->
<section class="card step" id="s3">
<div class="row" style="justify-content:space-between; align-items:baseline">
<h2>Question 8 ‚Äî 12 h plus tard‚Ä¶ puis 24 h plus tard</h2>
<div class="ws-tip" aria-live="polite"></div>

</div>
<p class="q9consigne"><strong>Consigne :</strong> Choisis un instant (0 h, +12 h, +24 h) puis observe quelles villes sont du c√¥t√© √©clair√© (jour) ou du c√¥t√© sombre (nuit). Compl√®te le tableau pour chaque instant.</p>
<div class="animWrap">
<div class="row" style="justify-content:space-between">
<strong>Choisis un instant</strong>
<span class="pill" id="tSel">Temps : 0 h</span>
</div>
<svg aria-label="Mod√®le 12h 24h" role="img" viewbox="0 0 560 260">
<circle cx="110" cy="130" fill="rgba(255,211,77,.85)" r="45"></circle>
<line stroke="rgba(255,255,255,.35)" stroke-width="3" x1="155" x2="235" y1="130" y2="130"></line>
<g id="tG" transform="translate(380 130)">
<circle fill="#2dd4bf" opacity=".9" r="95"></circle>
<path d="M0,-95 A95,95 0 0,1 0,95 A95,95 0 0,1 0,-95 Z" fill="rgba(0,0,0,.48)"></path>
<circle cx="60" cy="-25" fill="#ff4d8d" r="7" stroke="white" stroke-width="3"></circle>
<text fill="white" font-size="13" x="78" y="-28">Madrid</text>
<circle cx="-60" cy="30" fill="#60a5fa" r="7" stroke="white" stroke-width="3"></circle>
<text fill="white" font-size="13" x="-150" y="34">Sydney</text>
</g>
</svg>
<div class="row" style="gap:14px; margin-top:6px">
<button class="btn" onclick="setT(0)">0 h</button>
<button class="btn" onclick="setT(12)">+12 h</button>
<button class="btn" onclick="setT(24)">+24 h</button>
</div>
</div>
<div style="height:10px"></div>
<table>
<thead><tr><th>Ville</th><th class="center">Jour</th><th class="center">Nuit</th></tr></thead>
<tbody>
<tr>
<td><strong>Madrid</strong></td>
<td class="center"><input name="m_t" type="radio" value="jour"/></td>
<td class="center"><input name="m_t" type="radio" value="nuit"/></td>
</tr>
<tr>
<td><strong>Sydney</strong></td>
<td class="center"><input name="s_t" type="radio" value="jour"/></td>
<td class="center"><input name="s_t" type="radio" value="nuit"/></td>
</tr>
</tbody>
</table>
<div class="status" id="st8"></div>
<div class="row" style="margin-top:10px">
<button class="btn primary" onclick="checkT()">Valider</button>
<button class="btn" onclick="toggle('c8')">Voir la correction</button>
<button class="btn" onclick="resetT()">Recommencer</button>
<button class="btn ok" onclick="go(9)">Question 8 ‚Üí</button>
</div>
<div class="corr" id="c8"><div class="corrTitle" style="font-weight:950; margin-top:10px">Correction :</div>
<div style="margin-top:6px; line-height:1.4">
<ul style="margin:6px 0 0 18px">
<li><strong>0 h</strong> : <strong>Madrid = Jour</strong> ; <strong>Sydney = Nuit</strong></li>
<li><strong>+12 h</strong> : <strong>Madrid = Nuit</strong> ; <strong>Sydney = Jour</strong></li>
<li><strong>+24 h</strong> : <strong>Madrid = Jour</strong> ; <strong>Sydney = Nuit</strong> (retour √† la situation de d√©part)</li>
</ul>
</div></div>

</section><section id="s9" class="step">
  <h2>Question 9 ‚Äì Situations 1 et 2 : jour / nuit</h2>
<div class="ws-tip" id="wsTipQ10" aria-live="polite">

  <div class="q10-consigne">
    <strong>Consigne :</strong> Observe la <strong>situation 1</strong>. Clique ensuite sur <strong>+6 h</strong> pour passer √† la <strong>situation 2</strong>.
    D√©termine si les points <strong>A</strong>, <strong>B</strong> et <strong>C</strong> sont le <strong>jour</strong> (c√¥t√© √©clair√©) ou la <strong>nuit</strong> (c√¥t√© sombre).
  </div>

  <div class="q10-grid">
    <div class="q10-anim card">
      <div class="q10-toprow">
        <div class="q10-pill" id="q10State">Situation 1</div>
        <div class="q10-pill" id="q10Time">t = 0 h</div>
      </div>

      <div class="q10-scene" aria-label="Animation Terre Soleil, jour et nuit, points A B C">
        <div class="q10-sun" aria-hidden="true"></div>

        <div class="q10-earthWrap">
          <div class="q10-earth" id="q10Earth" role="img" aria-label="Terre avec face √©clair√©e et face sombre">
            <div class="q10-tex" id="q10Tex"></div>
            <div class="q10-sphere" aria-hidden="true"></div>
            <div class="q10-daynight" aria-hidden="true"></div>
            <div class="q10-terminator" aria-hidden="true"></div>

            <div class="q10-point" id="q10A" data-label="A"></div>
            <div class="q10-point" id="q10B" data-label="B"></div>
            <div class="q10-point" id="q10C" data-label="C"></div>
          </div>
          <div class="q10-earthLabel">Terre</div>
        </div>
      </div>

      <div class="q10-controls">
        
        <button class="btn" id="q10Plus6">+6 h</button>
        <button class="btn" id="q10Reset">Retour Situation 1</button>
      </div>
    </div>

    <div class="q10-qcm card">
      <div style="font-weight:900; margin-bottom:6px">Questions</div>

      <div class="q10-q">
        <div class="q10-qtitle">10.1 ‚Äì Situation 1 (t = 0 h)</div>
        <div class="q10-mini">Indique si chaque point est <strong>Jour</strong> ou <strong>Nuit</strong>.</div>

        <div class="q10-row">
          <div class="q10-lbl">Point A</div>
          <label><input type="radio" name="q10_s1_a" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s1_a" value="nuit"> Nuit</label>
        </div>
        <div class="q10-row">
          <div class="q10-lbl">Point B</div>
          <label><input type="radio" name="q10_s1_b" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s1_b" value="nuit"> Nuit</label>
        </div>
        <div class="q10-row">
          <div class="q10-lbl">Point C</div>
          <label><input type="radio" name="q10_s1_c" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s1_c" value="nuit"> Nuit</label>
        </div>
      </div>

      <div class="q10-q">
        <div class="q10-qtitle">10.2 ‚Äì Situation 2 (6 h plus tard)</div>
        <div class="q10-mini">Apr√®s <strong>+6 h</strong>, indique √† nouveau <strong>Jour</strong> ou <strong>Nuit</strong>.</div>

        <div class="q10-row">
          <div class="q10-lbl">Point A</div>
          <label><input type="radio" name="q10_s2_a" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s2_a" value="nuit"> Nuit</label>
        </div>
        <div class="q10-row">
          <div class="q10-lbl">Point B</div>
          <label><input type="radio" name="q10_s2_b" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s2_b" value="nuit"> Nuit</label>
        </div>
        <div class="q10-row">
          <div class="q10-lbl">Point C</div>
          <label><input type="radio" name="q10_s2_c" value="jour"> Jour</label>
          <label><input type="radio" name="q10_s2_c" value="nuit"> Nuit</label>
        </div>
      </div>

      <div class="q10-q">
        <div class="q10-qtitle">10.3 ‚Äì Retour √† la position initiale</div>
        <div class="q10-mini">Au bout de combien de temps les points retrouveront-ils la position de la Situation 1 ?</div>
        <label class="q10-choice"><input type="radio" name="q10_tour" value="6"> 6 h</label>
        <label class="q10-choice"><input type="radio" name="q10_tour" value="12"> 12 h</label>
        <label class="q10-choice"><input type="radio" name="q10_tour" value="24"> 24 h</label>
        <label class="q10-choice"><input type="radio" name="q10_tour" value="48"> 48 h</label>
      </div>

      <button class="btn primary" id="q10Check">Corriger</button>
      <div id="q10Res" class="q10-res" aria-live="polite"></div>
    </div>
  </div>
</section>
<div id="finalSynthese" class="q10-conclusion card" style="display:none; margin:14px auto; max-width: 980px;">
  <strong> </strong><br>
  La Terre tourne sur elle-m√™me en environ <strong>24 heures</strong>.
  Lorsqu‚Äôun point de la surface terrestre se trouve du c√¥t√© <strong>√©clair√©</strong> par le Soleil, il fait <strong>jour</strong>.
  Lorsqu‚Äôil se trouve du c√¥t√© <strong>sombre</strong>, il fait <strong>nuit</strong>.<br>
  La rotation de la Terre explique donc l‚Äô<strong>alternance du jour et de la nuit</strong>.
</div>

<style>
/* ===== Q10 scoped ===== */
#s9 .card{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  padding:14px;
  box-shadow:0 18px 50px rgba(0,0,0,.20);
}
#s9 .q10-consigne{
  margin:10px 0 12px;
  padding:10px 12px;
  border-radius:14px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
}
#s9 .q10-grid{
  display:grid;
  grid-template-columns: 1.05fr 1fr;
  gap:14px;
  align-items:start;
}
@media (max-width: 820px){
  #s9 .q10-grid{ grid-template-columns: 1fr; }
}
#s9 .q10-toprow{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;
  margin-bottom:10px;
}
#s9 .q10-pill{
  padding:7px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  font-weight:900;
  font-size:13px;
}
#s9 .q10-scene{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:22px;
  padding:10px 0 6px;
}
#s9 .q10-sun{
  width:150px; height:150px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 25%,
    rgba(255,255,255,.95) 0%,
    rgba(255,232,168,.92) 18%,
    rgba(255,193,7,.85) 45%,
    rgba(255,152,0,.70) 70%,
    rgba(255,152,0,.35) 100%);
  filter: drop-shadow(0 16px 40px rgba(255,193,7,.25));
}
#s9 .q10-earthWrap{ display:grid; place-items:center; gap:6px; }
#s9 .q10-earthLabel{ font-weight:900; opacity:.9; }

#s9 .q10-earth{
  width:240px; height:240px;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  background:#071027;
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 20px 60px rgba(0,0,0,.35);
}
#s9 .q10-tex{
  position:absolute; inset:0;
  border-radius:50%;
  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1024' height='512' viewBox='0 0 1024 512'><defs><linearGradient id='sea' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='%232a7be6'/><stop offset='1' stop-color='%230a3b7a'/></linearGradient></defs><rect width='1024' height='512' fill='url(%23sea)'/><g opacity='0.22' fill='white'><ellipse cx='140' cy='90' rx='100' ry='40'/><ellipse cx='250' cy='140' rx='140' ry='52'/><ellipse cx='740' cy='110' rx='150' ry='52'/><ellipse cx='890' cy='170' rx='130' ry='48'/></g><g fill='%233bbf6a'><path d='M160,265 C230,210 300,210 350,255 C372,280 380,325 350,352 C305,390 245,395 208,358 C180,335 155,312 142,298 Z'/><path d='M430,195 C495,160 575,170 620,208 C652,235 660,272 625,295 C570,333 498,326 465,292 C445,270 420,238 415,223 Z'/><path d='M635,255 C680,218 755,220 810,258 C840,278 848,320 815,340 C755,376 685,368 655,336 C635,315 620,285 625,270 Z'/></g></svg>");
  background-size:200% 100%;
  background-repeat:repeat-x;
  background-position: var(--bx, 0%) 50%;
  transform: translateZ(0);
}
#s9 .q10-sphere{
  position:absolute; inset:0; border-radius:50%; pointer-events:none;
  background:
    radial-gradient(circle at 30% 25%,
      rgba(255,255,255,.28) 0%,
      rgba(255,255,255,.10) 35%,
      rgba(255,255,255,0) 62%),
    radial-gradient(circle at 70% 75%,
      rgba(0,0,0,.10) 0%,
      rgba(0,0,0,.25) 55%,
      rgba(0,0,0,.40) 78%,
      rgba(0,0,0,.50) 100%);
  mix-blend-mode:multiply;
}
#s9 .q10-daynight{
  position:absolute; inset:0; border-radius:50%; pointer-events:none;
  background: linear-gradient(to right,
    rgba(255,255,255,0.30) 0%,
    rgba(255,255,255,0.05) 35%,
    rgba(0,0,0,0.70) 52%,
    rgba(0,0,0,0.92) 68%,
    rgba(0,0,0,0.98) 100%);
  mix-blend-mode:multiply;
}
#s9 .q10-point{
  position:absolute;
  width:12px; height:12px;
  border-radius:50%;
  background:#111827;
  border:2px solid #fff;
  box-shadow:0 0 0 3px rgba(0,0,0,.35);
  transform: translate(-50%,-50%);
  z-index:6;
}
#s9 .q10-point::after{
  content: attr(data-label);
  position:absolute;
  left: 14px; top: -6px;
  font-weight:950;
  font-size:12px;
  color:#fff;
  white-space:nowrap;
  text-shadow: 0 2px 8px rgba(0,0,0,.85);
}
#s9 .q10-controls{
  display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-start;
  margin-top:10px;
}
#s9 .q10-q{ margin:10px 0; padding:10px; border-radius:14px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); }
#s9 .q10-qtitle{ font-weight:950; margin-bottom:4px; }
#s9 .q10-mini{ opacity:.9; font-size:14px; margin-bottom:8px; }
#s9 .q10-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin:6px 0; }
#s9 .q10-lbl{ width:70px; font-weight:900; }
#s9 .q10-choice{ display:block; margin:6px 0; font-weight:800; }
#s9 .q10-res{ margin-top:10px; font-weight:950; }

#s9 .q10-terminator{
  position:absolute;
  top:0; bottom:0;
  left:50%;
  width:0;
  border-left:2px dashed rgba(255,255,255,0.7);
  pointer-events:none;
  z-index:5;
}

</style>

<script>
(function(){
  const tex = document.getElementById('q10Tex');
  const elA = document.getElementById('q10A');
  const elB = document.getElementById('q10B');
  const elC = document.getElementById('q10C');
  const lblState = document.getElementById('q10State');
  const lblTime  = document.getElementById('q10Time');

  
  const btnPlus6 = document.getElementById('q10Plus6');
  const btnReset = document.getElementById('q10Reset');
  const btnCheck = document.getElementById('q10Check');
  const res = document.getElementById('q10Res');

  const R = 120, CX = 120, CY = 120;

    const points = [
    // Positions ajust√©es pour correspondre au sch√©ma (Situation 1 / Situation 2)
    // A : haut-droite en S1 -> haut-gauche en S2
    {name:'A', el: elA, lat: 30, lon: 140},
    // B : gauche-bas en S1 -> bas (proche du centre) en S2
    {name:'B', el: elB, lat: -20, lon: -110},
    // C : bas-droite en S1 -> droite en S2
    {name:'C', el: elC, lat: -25, lon: 50},
  ];

  let running = false;
  function setRunning(on){ running = !!on; }
  let omega = 12;
  let rotDeg = 0;
  let tLast = performance.now();

  let hours = 0;
  function setLabels(){
    lblTime.textContent = 't = ' + hours + ' h';
    lblState.textContent = (hours === 0) ? 'Situation 1' : 'Situation 2';
  }

  function project(latDeg, lonDeg){
    const lat = latDeg * Math.PI/180;
    const lon = lonDeg * Math.PI/180;
    const x = Math.cos(lat) * Math.sin(lon);
    const y = Math.sin(lat);
    const z = Math.cos(lat) * Math.cos(lon);
    const px = CX + R * x;
    const py = CY - R * y;
    return {px, py, z};
  }

  function placePoints(){
    const bx = (-(rotDeg/360)*100) % 100;
    tex.style.setProperty('--bx', bx.toFixed(2) + '%');

    for(const p0 of points){
      const lon = p0.lon + rotDeg;
      const p = project(p0.lat, lon);
      p0.el.style.left = p.px.toFixed(1) + 'px';
      p0.el.style.top  = p.py.toFixed(1) + 'px';

      p0.el.style.opacity = '1';
      p0.el.style.filter = 'none';

      const day = (p.px < CX);
      p0.el.style.background = day ? '#22c55e' : '#111827';
    }
  }

  function tick(now){
    const dt = (now - tLast)/900;
    tLast = now;
    
    requestAnimationFrame(tick);
  }

  

  function plus6h(){
    hours = 6;
    rotDeg = (rotDeg + 90) % 360;
    setLabels();
    placePoints();
  }
  function reset(){
    hours = 0;
    rotDeg = 0;
    setLabels();
    placePoints();
    setRunning(false);
  }

  function readRadio(name){
    const r = document.querySelector('input[name="'+name+'"]:checked');
    return r ? r.value : null;
  }

  function expectedFor(rot){
    const exp = {};
    for(const p0 of points){
      const lon = p0.lon + rot;
      const pp = project(p0.lat, lon);
      exp[p0.name] = (pp.px < CX) ? 'jour' : 'nuit';
    }
    return exp;
  }

  function corriger(){
    const expS1 = expectedFor(0);
    const expS2 = expectedFor(90);

    let score = 0, total = 7;

    const ans = {
      s1a: readRadio('q10_s1_a'),
      s1b: readRadio('q10_s1_b'),
      s1c: readRadio('q10_s1_c'),
      s2a: readRadio('q10_s2_a'),
      s2b: readRadio('q10_s2_b'),
      s2c: readRadio('q10_s2_c'),
      tour: readRadio('q10_tour'),
    };

    if(ans.s1a === expS1.A) score++;
    if(ans.s1b === expS1.B) score++;
    if(ans.s1c === expS1.C) score++;
    if(ans.s2a === expS2.A) score++;
    if(ans.s2b === expS2.B) score++;
    if(ans.s2c === expS2.C) score++;
    if(ans.tour === '24') score++;

    const lineS1 = `Situation 1 : A = ${expS1.A.toUpperCase()}, B = ${expS1.B.toUpperCase()}, C = ${expS1.C.toUpperCase()}.`;
    const lineS2 = `Situation 2 (+6 h) : A = ${expS2.A.toUpperCase()}, B = ${expS2.B.toUpperCase()}, C = ${expS2.C.toUpperCase()}.`;
    const lineT  = `Retour √† la position initiale : 24 h (un tour complet).`;

    if(score === total){
      res.textContent = "‚úî Bravo ! Tout est correct. " + lineS1 + " " + lineS2 + " " + lineT;
      res.style.color = "#22c55e";
    }else{
      res.textContent = "Score : " + score + " / " + total + " ‚Äî " + lineS1 + " " + lineS2 + " " + lineT;
      res.style.color = "#fbbf24";
    }
  }

  
  btnPlus6.addEventListener('click', plus6h);
  btnReset.addEventListener('click', reset);
  btnCheck.addEventListener('click', corriger);

  setLabels();
  placePoints();
  setRunning(false);
  requestAnimationFrame(tick);
})();
</script>
</main>
<div class="footnav">
<div class="row">
<button class="btn" onclick="prev()">‚Üê Pr√©c√©dent</button>
<button class="btn ok" onclick="next()">Suivant ‚Üí</button>
</div>
</div>
<script>
/* =======================
   NAVIGATION + OUTILS
======================= */
let step=0; const maxStep = 9;
function go(n){
  const steps = Array.from(document.querySelectorAll('.step'));
  const max = steps.length - 1;
  step = Math.max(0, Math.min(max, n));
  steps.forEach(s=>s.classList.remove('active'));
  if(steps[step]) steps[step].classList.add('active');
  document.getElementById('pillStep').textContent='√âtape '+step+'/'+max;
  document.getElementById('prog').style.width=(step/max*100).toFixed(0)+'%';
  updateQ1ModelLocation();
  // iPad/Safari: force recalcul taille canvas apr√®s changement d'√©tape
  try{ window.dispatchEvent(new Event('resize')); }catch(e){}
  if(step === 2){ setTimeout(prepareQ2Model, 60); }
  window.scrollTo({top:0,behavior:'smooth'});
}
function updateQ1ModelLocation(){
  // D√©place le m√™me mod√®le 3D entre Q1 (s1) et Q2 (s2) pour √©viter de dupliquer Three.js
  const wrap = document.getElementById('q1ModelWrap');
  const hostQ2 = document.getElementById('q2ModelHost');
  const s1 = document.getElementById('s1');
  if(!wrap || !hostQ2 || !s1) return;

  // Si on est √† l'√©tape 2, on met le mod√®le dans Q2, sinon on le remet dans Q1 (en haut de s1)
  if(step === 2){
    if(!hostQ2.contains(wrap)) hostQ2.appendChild(wrap);
  }else{
    if(!s1.contains(wrap)){
      // On le remet au bon endroit : juste apr√®s la consigne de Q1
      const anchor = s1.querySelector('.hint');
      if(anchor && anchor.parentNode){
        anchor.parentNode.insertBefore(wrap, anchor.nextSibling);
      }else{
        s1.appendChild(wrap);
      }
    }
  }
}

function prepareQ2Model(){
  // R√©glage automatique pour l'exercice de la question 2
  if(window.Q1API){
    window.Q1API.setObj('boule');
    window.Q1API.setRange(1.3); // ‚âà 2/3 (1.3 sur un curseur 0‚Üí2)
    window.Q1API.lock(true);
  }
}

function showWSModal(message, onOk){ if(typeof onOk==='function') onOk(); }



function rappelFicheQ2(){
  const modal = document.getElementById('wsModal');
  const msg   = document.getElementById('wsModalMsg');
  const okBtn = document.getElementById('wsModalOk');
  if(!modal || !msg || !okBtn) return;



  modal.style.display = "grid";

  okBtn.onclick = function(){
    modal.style.display = "none";
    go(step + 1);
  };
}


function rappelConclusionQ9(){
  const modal = document.getElementById('wsModal');
  const msg   = document.getElementById('wsModalMsg');
  const okBtn = document.getElementById('wsModalOk');
  if(!modal || !msg || !okBtn) return;

  msg.innerHTML =
    "<strong> </strong><br>" +
        "La Terre tourne sur elle-m√™me en environ <strong>24 heures</strong>. " +
    "Lorsqu‚Äôun point de la surface terrestre se trouve du c√¥t√© <strong>√©clair√©</strong> par le Soleil, il fait <strong>jour</strong>. " +
    "Lorsqu‚Äôil se trouve du c√¥t√© <strong>sombre</strong>, il fait <strong>nuit</strong>. " +
    "La rotation de la Terre explique donc l‚Äô<strong>alternance du jour et de la nuit</strong>." +
    "</div>" ;

  modal.style.display = "grid";

  okBtn.onclick = function(){
    modal.style.display = "none";
    go(step + 1);
  };
}


function next(){
  // Question 2 : rappel fiche (Q1 de la fiche) ‚Äî POP-UP D√âSACTIV√â
  // if(step === 2){
  //   rappelFicheQ2();
  //   return;
  // }

  // Question 9 : afficher la conclusion √† recopier + rappeler Q6 fiche
  try{
    const active = document.querySelector('.step.active');
    const h2 = active ? active.querySelector('h2') : null;
    const isQ9 = h2 && /Question\s*9\b/.test(h2.textContent || '');
    if(isQ9){
      rappelConclusionQ9();
      return;
    }
  }catch(e){}

  go(step+1);
}
function prev(){ go(step-1); }
document.getElementById('btnHome').addEventListener('click',()=>go(0));

function toggle(id){
  const el=document.getElementById(id);
  if(!el) return;
  el.style.display=(el.style.display==='block')?'none':'block';
}
function setStatus(id, ok, html){
  const st=document.getElementById(id);
  st.className='status '+(ok?'ok':'bad');
  st.innerHTML=(ok?'‚úÖ ':'‚ùå ')+html;
  st.style.display='block';
}
function getChecked(name){
  const el=document.querySelector('input[name="'+name+'"]:checked');
  return el?el.value:null;
}
function checkMCQ(name, good, stId, okMsg){
  const v=getChecked(name);
  if(!v) return setStatus(stId,false,'Choisis une r√©ponse.');
  if(v===good) setStatus(stId,true, okMsg);
  else setStatus(stId,false,'R√©essaie : observe le mod√®le.');
}

/* =======================
   DRAG & DROP (iPad fiable)
======================= */
function getPt(e){
  if(e.touches && e.touches.length) return {x:e.touches[0].clientX, y:e.touches[0].clientY};
  return {x:e.clientX, y:e.clientY};
}
function enableDrag(el){
  let startX=0,startY=0,origX=0,origY=0,floating=false,pid=null;

  const onDown=(e)=>{
    if(el.dataset.placed==="1") return;
    pid=e.pointerId;
    el.setPointerCapture(pid);

    const pt=getPt(e);
    startX=pt.x; startY=pt.y;

    const r=el.getBoundingClientRect();
    origX=r.left; origY=r.top;

    el.classList.add('floating');
    el.style.left=origX+'px';
    el.style.top=origY+'px';
    el.style.width=r.width+'px';

    floating=true;
    document.addEventListener('pointermove', onMove, {passive:false});
    document.addEventListener('pointerup', onUp, {passive:false});
    e.preventDefault();
  };

  const onMove=(e)=>{
    if(!floating) return;
    const pt=getPt(e);
    el.style.left=(origX+(pt.x-startX))+'px';
    el.style.top =(origY+(pt.y-startY))+'px';
    e.preventDefault();
  };

  const onUp=(e)=>{
    if(!floating) return;
    floating=false;
    try{ el.releasePointerCapture(pid); }catch(_){}
    document.removeEventListener('pointermove', onMove);
    document.removeEventListener('pointerup', onUp);

    const pt=getPt(e);

    // meilleure d√©tection zone : on masque la chip
    el.style.display='none';
    const dz=document.elementFromPoint(pt.x,pt.y)?.closest('.dropzone');
    el.style.display='inline-flex';

    if(dz){
      const accept=dz.dataset.accept, key=el.dataset.key;
      if(accept && key){
        const placed=dz.querySelector('.placed');
        if(placed){
          placed.innerHTML='';
          const clone=el.cloneNode(true);
          clone.classList.remove('floating');
          clone.style.position='static';
          clone.style.left=''; clone.style.top=''; clone.style.width='';
          clone.dataset.placed="1";
          clone.title="Touchez pour retirer";

          clone.addEventListener('click',()=>{
            clone.remove();
            el.dataset.placed="0";
          });

          placed.appendChild(clone);
          el.dataset.placed="1";
        }
      }
    }

    el.classList.remove('floating');
    el.style.position='static';
    el.style.left=''; el.style.top=''; el.style.width='';
    e.preventDefault();
  };

  el.addEventListener('pointerdown', onDown, {passive:false});
}
function shuffleArray(a){
  const arr=a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    const t=arr[i]; arr[i]=arr[j]; arr[j]=t;
  }
  return arr;
}
function makeChips(containerId, chips, shuffle){
  const box=document.getElementById(containerId);
  box.innerHTML='';
  const list = shuffle ? shuffleArray(chips) : chips;
  list.forEach(ch=>{
    const el=document.createElement('div');
    el.className='chip';
    el.dataset.key=ch.key;
    el.innerHTML='<span class="dot"></span>'+ch.label;
    box.appendChild(el);
    enableDrag(el);
  });
}

/* =======================
   STEP 1 : Projecteur
======================= */
function setLamp(v,force){
  v=Number(v);
  const lbl=document.getElementById('lampLbl');
  const beam=document.getElementById('beam');
  const selfS=document.getElementById('selfShadow');
  const castS=document.getElementById('castShadow');

  // ‚úÖ L‚Äôanimation ‚ÄúPCCl‚Äù est int√©gr√©e en iframe : il n‚Äôy a plus d‚Äô√©l√©ments SVG (beam/selfShadow/castShadow).
  // On garde le curseur uniquement comme consigne, sans provoquer d‚Äôerreur JS.
  if(lbl) lbl.textContent='Puissance : '+v+'%';
  if(force){
    const r=document.getElementById('lamp');
    if(r) r.value=v;
  }
  if(!beam || !selfS || !castS) return;

  const alpha = Math.min(0.55, v/200);
  beam.setAttribute('fill','rgba(255,211,77,'+alpha.toFixed(2)+')');

  const sA = Math.min(0.55, v/180);
  selfS.setAttribute('fill','rgba(0,0,0,'+sA.toFixed(2)+')');
  castS.setAttribute('fill','rgba(0,0,0,'+(sA*0.9).toFixed(2)+')');
}
function placeStatue(){
  setStatus('st0', true, "Statuette plac√©e au milieu ‚úÖ Observe : une partie n'est pas √©clair√©e.");
}

/* =======================
   STEP 2/3 : Vocab + labels
======================= */

/* =======================
   STEP 2 : Q2 (drag & drop sur l'animation)
======================= */
function resetQ2(){
  makeChips('q2Chips', vocab, true);
  document.querySelectorAll('#s2 .dropzone .placed').forEach(p=>p.innerHTML='');
  const st=document.getElementById('stQ2');
  if(st) st.style.display='none';
}
function checkQ2(){
  let ok=true;
  document.querySelectorAll('#s2 .dropzone').forEach(dz=>{
    const accept=dz.dataset.accept;
    const chip=dz.querySelector('.placed .chip');
    if(!chip || chip.dataset.key!==accept) ok=false;
  });
  ok ? setStatus('stQ2',true,'Bravo : rep√©rage correct.')
     : setStatus('stQ2',false,'Encore une erreur. Rappel : ombre port√©e = sur l‚Äô√©cran ; ombre propre = sur l‚Äôobjet.');
}

// init Q2 + Q3 √©tiquettes au chargement
document.addEventListener('DOMContentLoaded', function(){
  if(document.getElementById('q2Chips')) resetQ2();
  if(document.getElementById('imgChips')) resetImageLabels();
  updateQ1ModelLocation();
  // iPad/Safari: force recalcul taille canvas apr√®s changement d'√©tape
  try{ window.dispatchEvent(new Event('resize')); }catch(e){}
  if(step === 2){ setTimeout(prepareQ2Model, 60); }
});

const vocab=[
  {key:'objet',label:'Objet'},
  {key:'ombre_propre',label:'Ombre propre'},
  {key:'ombre_portee',label:'Ombre port√©e'}
];

function resetVocab(){
  makeChips('vocabChips', vocab, true); // ‚úÖ m√©lange
  document.querySelectorAll('#s2 .dropzone .placed').forEach(p=>p.innerHTML='');
  document.getElementById('st1').style.display='none';
}
function checkVocab(){
  let ok=true;
  document.querySelectorAll('#s2 .dropzone').forEach(dz=>{
    const accept=dz.dataset.accept;
    const chip=dz.querySelector('.placed .chip');
    if(!chip || chip.dataset.key!==accept) ok=false;
  });
  ok ? setStatus('st1',true,'Parfait.')
     : setStatus('st1',false,'Au moins une association est incorrecte. Clique sur une √©tiquette pos√©e pour la retirer.');
}

function resetImageLabels(){
  makeChips('imgChips', vocab, true);
  document.querySelectorAll('#s3 .dropzone .placed').forEach(p=>p.innerHTML='');
  document.getElementById('st2').style.display='none';
}
function checkImageLabels(){
  let ok=true;
  document.querySelectorAll('#s3 .dropzone').forEach(dz=>{
    const accept=dz.dataset.accept;
    const chip=dz.querySelector('.placed .chip');
    if(!chip || chip.dataset.key!==accept) ok=false;
  });
  ok ? setStatus('st2',true,'Bravo : l√©gende correcte.')
     : setStatus('st2',false,'Encore une erreur. Rappel : ombre port√©e = sur mur/sol ; ombre propre = sur l‚Äôobjet.');
}

/* =======================
   STEP 4 : Rotation (2 vues) + r√©ponse
======================= */
function setRotHour(h){
  h = Number(h);
  document.getElementById('rotHourLbl').textContent = String(h);

  const ang = (h/24) * 360;

  // Vue "dessus" : on fait tourner le rep√®re.
  const top = document.getElementById('rotTopG');
  if(top) top.setAttribute('transform','translate(340 150) rotate(' + ang + ')');

  // Vue "profil" : la Terre tourne sur elle-m√™me "le long" de l'√©quateur.
  // On garde l'√©clairage jour/nuit FIXE (Soleil √† gauche) et on d√©place la ville sur l'ellipse de l'√©quateur.
  const city = document.getElementById('rotCity_prof');
  const cityLbl = document.getElementById('rotCityLbl_prof');
  if(city){
    const rx = 75, ry = 24;
    // D√©calage de phase pour d√©marrer en bas (devant) quand h=0
    const t = (h/24) * Math.PI * 2 + Math.PI/2;
    const cx = rx * Math.cos(t);
    const cy = ry * Math.sin(t);

    city.setAttribute('cx', cx.toFixed(1));
    city.setAttribute('cy', cy.toFixed(1));

    if(cityLbl){
      cityLbl.setAttribute('x', cx.toFixed(1));
      cityLbl.setAttribute('y', (cy + 22).toFixed(1));
    }

    // Effet avant/arri√®re : avant = demi-ellipse du bas (cy > 0)
    const front = (Math.sin(t) > 0);
    city.setAttribute('opacity', front ? '1' : '0.35');
    city.setAttribute('r', front ? '6' : '5');
  }
}
function checkRot(){
  const n=(document.getElementById('rotAns').value||'').trim();
  const u=document.getElementById('rotUnit').value;
  if(!n || !u) return setStatus('st3',false,"√âcris un nombre et choisis une unit√©.");
  const num=parseFloat(n.replace(',','.'));
  const ok = (u==='h' && Math.abs(num-24)<=1) || (u==='jour' && Math.abs(num-1)<=0.2);
  ok ? setStatus('st3',true,"Correct : environ 24 h (‚âà 1 jour).")
     : setStatus('st3',false,"R√©essaie : c‚Äôest la dur√©e d‚Äôun jour complet.");
}

/* =======================
   STEP 5 : R√©volution + distance + r√©ponse
======================= */

/* --- Nouvelle animation Q5 (div) --- */
const REVOLUTION_DAYS = 365;
const REV_SPEED_NORMAL = 8;   // jours simul√©s / seconde
const REV_SPEED_FAST   = 24;  // acc√©l√©ration orbite
const EARTH_ROTATION_DAYS_VISUAL = 6; // rotation terrestre ralentie (√©chelle non respect√©e)

let revDay = 0;
let revPlaying = false;
let revFast = false;
let revRaf = 0;
let revLastTs = 0;

function renderRev(){
  const lbl = document.getElementById('revDayLbl');
  if(lbl) lbl.textContent = 'Jour : ' + Math.floor(revDay);

  const orbit = document.getElementById('q5Orbit');
  const earth = document.getElementById('q5Earth');
  if(!orbit || !earth) return;

  const theta = (revDay / REVOLUTION_DAYS) * (Math.PI * 2);
  orbit.style.transform = 'rotate(' + theta + 'rad)';

  // rotation terrestre ralentie pour √™tre visible
  const spin = (revDay / EARTH_ROTATION_DAYS_VISUAL) * (Math.PI * 2);
  earth.style.transform = 'translateX(var(--r)) rotate(' + spin + 'rad)';
}

function setRevDay(d){
  revDay = Math.max(0, Math.min(REVOLUTION_DAYS, Number(d) || 0));
  renderRev();
}

function addRevDay(dd){
  setRevDay(revDay + Number(dd || 0));
}

function toggleRevAccel(){
  revFast = !revFast;
  const b = document.getElementById('revAccelBtn');
  if(b){
    b.classList.toggle('primary', revFast);
    // texte reste identique pour ne pas changer la mise en page
  }
}

function toggleRevPlay(){
  revPlaying = !revPlaying;
  const b = document.getElementById('revPlayBtn');
  if(b) b.textContent = revPlaying ? '‚è∏ Pause' : '‚ñ∂Ô∏é Play';

  if(revPlaying){
    revLastTs = 0;
    revRaf = requestAnimationFrame(revTick);
  }else{
    if(revRaf) cancelAnimationFrame(revRaf);
    revRaf = 0;
  }
}

function revTick(ts){
  if(!revPlaying) return;
  if(!revLastTs) revLastTs = ts;

  const dt = (ts - revLastTs) / 1000;
  revLastTs = ts;

  const speed = revFast ? REV_SPEED_FAST : REV_SPEED_NORMAL;
  revDay += dt * speed;

  if(revDay >= REVOLUTION_DAYS){
    revDay = REVOLUTION_DAYS;
    renderRev();
    toggleRevPlay(); // stop √† la fin
    return;
  }

  renderRev();
  revRaf = requestAnimationFrame(revTick);
}

/* init */
document.addEventListener('DOMContentLoaded', function(){
  renderRev();
});

function checkRev(){

  const n=(document.getElementById('revAns').value||'').trim();
  const u=document.getElementById('revUnit').value;
  if(!n || !u) return setStatus('st4',false,"√âcris un nombre et choisis une unit√©.");
  const num=parseFloat(n.replace(',','.'));
  const ok = (u==='jour' && Math.abs(num-365)<=10) || (u==='annees' && Math.abs(num-1)<=0.2);
  ok ? setStatus('st4',true,"Correct : environ 365 jours (‚âà 1 ann√©e).")
     : setStatus('st4',false,"R√©essaie : c‚Äôest la dur√©e d‚Äôune ann√©e.");
}

/* =======================
   STEP 6 : mini r√©volution anim
======================= */
function setRevMini(deg){
  deg=Number(deg);
  const t=deg*Math.PI/180;
  const cx=260, cy=130, rx=170, ry=90;
  const x=cx + rx*Math.cos(t);
  const y=cy + ry*Math.sin(t);
  document.getElementById('revMiniG').setAttribute('transform','translate('+x.toFixed(1)+' '+y.toFixed(1)+')');
}

/* =======================
   STEP 7 : Mod√©lisation jour/nuit
======================= */
function setModHour(h){
  h=Number(h);
  document.getElementById('modLbl').textContent='Heure : '+h;

  // --- Nouveau mod√®le Q7 (globe illustr√©) ---
  const earth=document.getElementById('q7Earth');
  const mk=document.getElementById('q7Marker');
  if(earth && mk){
    const t = (h/24)*Math.PI*2; // 0..2œÄ

    // Continents qui d√©filent pour rendre la rotation visible
    const bx = ((-(h/24)*100) % 100);
    earth.style.setProperty('--bx', bx.toFixed(2) + '%');

    // Trajectoire (ellipse au Nord) en coordonn√©es SVG 220x220
    const cx=110, cy=110, northShift=44, Rx=88, Ry=22;
    const x = cx + Math.cos(t)*Rx;
    const y = (cy - northShift) + Math.sin(t)*Ry;

    // Avant/arri√®re : point plus grand et plus opaque quand il est "devant"
    const z = Math.sin(t);
    const scale = 0.72 + (z+1)*0.18;
    const alpha = 0.30 + (z+1)*0.35;

    mk.style.left = (x/220*100) + '%';
    mk.style.top  = (y/220*100) + '%';
    mk.style.transform = 'translate(-50%,-50%) scale(' + scale.toFixed(3) + ')';
    mk.style.opacity = alpha.toFixed(3);
  }

  // --- Compatibilit√© : si l'ancien SVG existe encore, on le fait tourner ---
  const g=document.getElementById('modG');
  if(g){
    const ang=(h/24)*360;
    g.setAttribute('transform','translate(420 140) rotate('+ang+')');
  }
}
function addMod(d){
  const r=document.getElementById('modHour');
  let v=(Number(r.value)+d)%25; if(v>24) v-=24;
  r.value=v; setModHour(v);
}

/* =======================
   STEP 8 : Villes (anim)
======================= */
const ms={m:null,s:null};
function setCityHour(h){
  h=Number(h);
  document.getElementById('cityLbl').textContent='Heure : '+h;
  const ang=(h/24)*360;
  document.getElementById('cityG').setAttribute('transform','translate(380 160) rotate('+ang+')');
}
function addCity(d){
  const r=document.getElementById('cityHour');
  let v=(Number(r.value)+d)%25; if(v>24) v-=24;
  r.value=v; setCityHour(v);
}
function pickDay(which,val){ ms[which]=val; document.getElementById('st7').style.display='none'; }
function resetMS(){ ms.m=null; ms.s=null; document.getElementById('st7').style.display='none'; }
function checkMS(){
  if(!ms.m || !ms.s) return setStatus('st7',false,'Choisis pour Madrid et Sydney.');
  const ok=(ms.m==='nuit' && ms.s==='jour'); // heure 0 du mod√®le
  ok ? setStatus('st7',true,'Correct ‚úÖ')
     : setStatus('st7',false,'R√©essaie : face au Soleil = jour.');
}

/* =======================
   STEP 9 : +12/+24 (anim + correction)
======================= */
let currentT=0;
function setT(t){
  currentT=t;
  document.getElementById('tSel').textContent='Temps : '+t+' h';
  const ang=(t/24)*360;
  document.getElementById('tG').setAttribute('transform','translate(380 130) rotate('+ang+')');
  document.querySelectorAll('input[name="m_t"],input[name="s_t"]').forEach(i=>i.checked=false);
  document.getElementById('st8').style.display='none';
}
function resetT(){ setT(currentT); }
function checkT(){
  const m=getChecked('m_t'), s=getChecked('s_t');
  if(!m || !s) return setStatus('st8',false,'Coche pour Madrid et Sydney.');

  let goodM='nuit', goodS='jour';
  if(currentT===12){ goodM='jour'; goodS='nuit'; }
  if(currentT===24){ goodM='nuit'; goodS='jour'; }

  (m===goodM && s===goodS)
    ? setStatus('st8',true,'Correct ‚úÖ')
    : setStatus('st8',false,'R√©essaie : +12 h on inverse, +24 h on revient au d√©but.');
}

/* =======================
   STEP 10 : A/B/C + retour
   (r√©ponses verrouill√©es d‚Äôapr√®s TON sch√©ma)
======================= */
const abc1 = { A:'nuit', B:'jour', C:'nuit' }; // Situation 1
const abc2 = { A:'jour', B:'nuit', C:'nuit' }; // Situation 2

function resetFinal(){
  document.getElementById('retour').value='';
  document.getElementById('st9').style.display='none';
  ['A1','B1','C1','A2','B2','C2'].forEach(name=>{
    document.querySelectorAll('input[name="'+name+'"]').forEach(i=>i.checked=false);
  });
}
function checkFinal(){
  let okABC=true;
  ['A','B','C'].forEach(p=>{
    const v1=getChecked(p+'1');
    const v2=getChecked(p+'2');
    if(!v1 || !v2) okABC=false;
    if(v1 && v1!==abc1[p]) okABC=false;
    if(v2 && v2!==abc2[p]) okABC=false;
  });

  const r=(document.getElementById('retour').value||'').trim();
  const okR=(r==='18');

  if(okABC && okR) return setStatus('st9',true,'Tout juste ‚úÖ');
  let msg='R√©essaie : ';
  if(!okABC) msg+='v√©rifie A/B/C (jour = c√¥t√© Soleil). ';
  if(!okR) msg+='pour le retour : 24 ‚àí 6 = 18.';
  setStatus('st9',false,msg);
}

/* =======================
   INIT
======================= */
setLamp(0,true);
resetVocab();
resetImageLabels();
setRotHour(0);
setRevDay(0);
setRevMini(0);
setModHour(0);
setCityHour(0);
setT(0);
</script>

<script>
/* ===== Guidance fiche papier (CH3 A1) ===== */
(function(){
  // Q8
  const tip8 = document.getElementById('wsTipQ8');
  const start8 = document.getElementById('q8startBtn');
  const speed8 = document.getElementById('q8speed2Btn');
  if(tip8 && start8){
    const base = "";
    tip8.innerHTML = "<strong></strong> " + base;
    start8.addEventListener('click', ()=>{
      // after first click, keep reminder + ask to observer
      tip8.innerHTML = "<strong></strong> Observe l‚Äôanimation puis compl√®te la <strong>question 2</strong> (24 h, rotation).";
    });
    if(speed8){
      speed8.addEventListener('click', ()=>{
        tip8.innerHTML = "<strong></strong> (Rappel) compl√®te la <strong>question 2</strong> : 24 h = p√©riode de rotation.";
      });
    }
  }

  // Q10
  const tip10 = document.getElementById('wsTipQ10');
  const plus6 = document.getElementById('q10Plus6');
  const reset = document.getElementById('q10Reset');
  const check = document.getElementById('q10Check');
  if(tip10){
    if(plus6){
      plus6.addEventListener('click', ()=>{
        tip10.innerHTML = "<strong></strong> fais maintenant la <strong>question 6</strong> : en <strong>Situation 2 (+6 h)</strong>, indique Jour/Nuit pour A, B et C.";
      });
    }
    if(reset){
      reset.addEventListener('click', ()=>{
        tip10.innerHTML = "<strong></strong> (Retour) Situation 1 : compl√®te <strong>4a</strong> puis <strong>4b</strong>.";
      });
    }
    if(check){
      check.addEventListener('click', ()=>{
        tip10.innerHTML = "<strong></strong> termine avec la <strong>question ¬´ au bout de combien de temps ? ¬ª</strong> (r√©ponse : 24 h) et recopie la <strong>conclusion (Q5)</strong>.";
      });
    }
  }
})();
</script>

<div id="wsModal" class="wsModal" aria-hidden="true" style="display:none;">
  <div class="wsModalCard" role="dialog" aria-modal="true" aria-labelledby="wsModalTitle">
    <div id="wsModalTitle" class="wsModalTitle">Conclusion</div>
    <div id="wsModalMsg" class="wsModalMsg"></div>
    <div class="wsModalActions">
      <button id="wsModalOk" class="btn ok" type="button">OK</button>
    </div>
  </div>
</div>

<script>
(function(){
  function bindStart(){
    var b = document.getElementById('startBtn');
    if(!b) return;
    b.onclick = function(e){ try{ e.preventDefault(); }catch(_){ } go(1); };
    b.addEventListener('touchend', function(e){
      try{ e.preventDefault(); }catch(_){}
      go(1);
    }, {passive:false});
  }
  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded', bindStart, {once:true});
  }else{
    bindStart();
  }
})();
</script>


<script>
/* ===== Mode placement + figer (Q2) =====
   - Permet √† l'enseignant de d√©placer les zones 1/2/3 sur son √©cran (iPad/PC)
   - "Figer" sauvegarde sur cet appareil (localStorage)
   - "Copier positions" permet de copier un JSON √† me renvoyer pour int√©gration d√©finitive dans le HTML
*/
(function(){
  var ZONE_IDS = ["dz1","dz2","dz3"];
  var editOn = false;
  var drag = null;

  function px(n){ return Math.round(n) + "px"; }

  function loadZones(){
    try{
      var raw = localStorage.getItem("Q2_ZONES");
      if(!raw) return;
      var data = JSON.parse(raw);
      for(var i=0;i<ZONE_IDS.length;i++){
        var id = ZONE_IDS[i];
        var z = document.getElementById(id);
        if(!z || !data[id]) continue;
        if(data[id].left) z.style.left = data[id].left;
        if(data[id].top)  z.style.top  = data[id].top;
        if(data[id].width) z.style.width = data[id].width;
      }
    }catch(e){}
  }

  window.enableZoneEdit = function(on){
    editOn = !!on;
    for(var i=0;i<ZONE_IDS.length;i++){
      var z = document.getElementById(ZONE_IDS[i]);
      if(!z) continue;
      z.dataset.edit = editOn ? "1" : "0";
      z.style.cursor = editOn ? "move" : "";
      z.style.outline = editOn ? "3px solid rgba(96,165,250,.85)" : "";
    }
  };

  window.freezeZones = function(){
    var data = {};
    for(var i=0;i<ZONE_IDS.length;i++){
      var id = ZONE_IDS[i];
      var z = document.getElementById(id);
      if(!z) continue;
      data[id] = { left: z.style.left, top: z.style.top, width: z.style.width };
    }
    try{
      localStorage.setItem("Q2_ZONES", JSON.stringify(data));
    }catch(e){}
    // Sauvegarde locale OK (silencieux)
    if(window.wsToast) window.wsToast("Positions enregistr√©es sur cet appareil.");
  };

  window.copyZones = function(){
    var data = {};
    for(var i=0;i<ZONE_IDS.length;i++){
      var id = ZONE_IDS[i];
      var z = document.getElementById(id);
      if(!z) continue;
      data[id] = { left: z.style.left, top: z.style.top, width: z.style.width };
    }
    var txt = JSON.stringify(data, null, 2);
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(txt).then(function(){
        if(window.wsToast) window.wsToast("Positions copi√©es dans le presse-papiers.");
      }).catch(function(){
        prompt("Copie ce texte :", txt);
      });
    }else{
      prompt("Copie ce texte :", txt);
    }
  };

  // Drag des zones (uniquement en mode placement)
  document.addEventListener("pointerdown", function(e){
    var z = e.target.closest ? e.target.closest(".dropzone") : null;
    if(!z || z.dataset.edit !== "1") return;

    var host = document.getElementById("q2AnimWrap");
    if(!host) return;

    var r = z.getBoundingClientRect();
    drag = { el: z, ox: e.clientX - r.left, oy: e.clientY - r.top };
    try{ z.setPointerCapture(e.pointerId); }catch(_){}
    e.preventDefault();
  }, {passive:false});

  document.addEventListener("pointermove", function(e){
    if(!drag) return;
    var host = document.getElementById("q2AnimWrap");
    if(!host) return;

    var hr = host.getBoundingClientRect();
    var x = e.clientX - hr.left - drag.ox;
    var y = e.clientY - hr.top  - drag.oy;

    // bornes
    x = Math.max(0, Math.min(x, hr.width  - 60));
    y = Math.max(0, Math.min(y, hr.height - 60));

    drag.el.style.left = px(x);
    drag.el.style.top  = px(y);
    e.preventDefault();
  }, {passive:false});

  document.addEventListener("pointerup", function(){
    drag = null;
  });

  // Charge positions au d√©marrage
  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", loadZones, {once:true});
  }else{
    loadZones();
  }
})();
</script>

</body>
</html>
